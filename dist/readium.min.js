!function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t){var n=function(e){this.baseUrl=e||""};n.prototype.nav=function(e,t,n){function r(e){var t=[];return Array.prototype.slice.call(e.childNodes).forEach(function(e){"ol"==e.tagName&&Array.prototype.slice.call(e.childNodes).forEach(function(e){"li"==e.tagName&&t.push(e)})}),t}function i(e){var t=null;return Array.prototype.slice.call(e.childNodes).forEach(function(e){("a"==e.tagName||"span"==e.tagName)&&(t=e)}),t}function o(e){var a=[],u=r(e),c=Array.prototype.slice.call(u),l=c.length;return 0===l?!1:(c.forEach(function(r){var u=r.getAttribute("id")||!1,c=i(r),l=c.getAttribute("href")||"",f=c.textContent||"",h=l.split("#"),d=h[0],p=o(r),g=t[d],m=n[g],v=m?m.cfi:"";u||(g?(m=n[g],u=m.id,v=m.cfi):u="epubjs-autogen-toc-id-"+s++),r.setAttribute("id",u),a.push({id:u,href:l,label:f,subitems:p,parent:e?e.getAttribute("id"):null,cfi:v})}),a)}var a=e.querySelector('nav[*|type="toc"]'),s=0;return a?o(a):[]},t.exports=n},{}],2:[function(e){var t=e("zepto"),n=function(e){return parseInt(e,10)||0};t.each(["min","max"],function(e,r){t.fn[r+"Size"]=function(e){var t,i;return e?(void 0!==e.width&&this.css(r+"-width",e.width),void 0!==e.height&&this.css(r+"-height",e.height),this):(t=this.css(r+"-width"),i=this.css(r+"-height"),{width:"max"===r&&(void 0===t||"none"===t||-1===n(t))&&Number.MAX_VALUE||n(t),height:"max"===r&&(void 0===i||"none"===i||-1===n(i))&&Number.MAX_VALUE||n(i)})}}),t.fn.isVisible=function(){return this.is(":visible")},t.each(["border","margin","padding"],function(e,r){t.fn[r]=function(e){return e?(void 0!==e.top&&this.css(r+"-top"+("border"===r?"-width":""),e.top),void 0!==e.bottom&&this.css(r+"-bottom"+("border"===r?"-width":""),e.bottom),void 0!==e.left&&this.css(r+"-left"+("border"===r?"-width":""),e.left),void 0!==e.right&&this.css(r+"-right"+("border"===r?"-width":""),e.right),this):{top:n(this.css(r+"-top"+("border"===r?"-width":""))),bottom:n(this.css(r+"-bottom"+("border"===r?"-width":""))),left:n(this.css(r+"-left"+("border"===r?"-width":""))),right:n(this.css(r+"-right"+("border"===r?"-width":"")))}}})},{zepto:11}],3:[function(e,t,n){!function(e,r){"use strict";"object"==typeof n?t.exports=r():"function"==typeof define&&define.amd?define(r):e.IPv6=r(e)}(this,function(e){"use strict";function t(e){var t=e.toLowerCase(),n=t.split(":"),r=n.length,i=8;""===n[0]&&""===n[1]&&""===n[2]?(n.shift(),n.shift()):""===n[0]&&""===n[1]?n.shift():""===n[r-1]&&""===n[r-2]&&n.pop(),r=n.length,-1!==n[r-1].indexOf(".")&&(i=7);var o;for(o=0;r>o&&""!==n[o];o++);if(i>o){for(n.splice(o,1,"0000");n.length<i;)n.splice(o,0,"0000");r=n.length}for(var a,s=0;i>s;s++){a=n[s].split("");for(var u=0;3>u&&("0"===a[0]&&a.length>1);u++)a.splice(0,1);n[s]=a.join("")}var c=-1,l=0,f=0,h=-1,d=!1;for(s=0;i>s;s++)d?"0"===n[s]?f+=1:(d=!1,f>l&&(c=h,l=f)):"0"===n[s]&&(d=!0,h=s,f=1);f>l&&(c=h,l=f),l>1&&n.splice(c,l,""),r=n.length;var p="";for(""===n[0]&&(p=":"),s=0;r>s&&(p+=n[s],s!==r-1);s++)p+=":";return""===n[r-1]&&(p+=":"),p}function n(){return e.IPv6===this&&(e.IPv6=r),this}var r=e&&e.IPv6;return{best:t,noConflict:n}})},{}],4:[function(e,t,n){!function(e,r){"use strict";"object"==typeof n?t.exports=r():"function"==typeof define&&define.amd?define(r):e.SecondLevelDomains=r(e)}(this,function(e){"use strict";var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ","do":" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ","in":" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch "},has:function(e){var t=e.lastIndexOf(".");if(0>=t||t>=e.length-1)return!1;var r=e.lastIndexOf(".",t-1);if(0>=r||r>=t-1)return!1;var i=n.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(r+1,t)+" ")>=0:!1},is:function(e){var t=e.lastIndexOf(".");if(0>=t||t>=e.length-1)return!1;var r=e.lastIndexOf(".",t-1);if(r>=0)return!1;var i=n.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(0,t)+" ")>=0:!1},get:function(e){var t=e.lastIndexOf(".");if(0>=t||t>=e.length-1)return null;var r=e.lastIndexOf(".",t-1);if(0>=r||r>=t-1)return null;var i=n.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(r+1,t)+" ")<0?null:e.slice(r+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n})},{}],5:[function(e,t,n){!function(r,i){"use strict";"object"==typeof n?t.exports=i(e("./punycode"),e("./IPv6"),e("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],i):r.URI=i(r.punycode,r.IPv6,r.SecondLevelDomains,r)}(this,function(e,t,n,r){"use strict";function i(e,t){return this instanceof i?(void 0===e&&(e="undefined"!=typeof location?location.href+"":""),this.href(e),void 0!==t?this.absoluteTo(t):this):new i(e,t)}function o(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function a(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function s(e){return"Array"===a(e)}function u(e,t){var n,r,i={};if(s(t))for(n=0,r=t.length;r>n;n++)i[t[n]]=!0;else i[t]=!0;for(n=0,r=e.length;r>n;n++)void 0!==i[e[n]]&&(e.splice(n,1),r--,n--);return e}function c(e,t){var n,r;if(s(t)){for(n=0,r=t.length;r>n;n++)if(!c(e,t[n]))return!1;return!0}var i=a(t);for(n=0,r=e.length;r>n;n++)if("RegExp"===i){if("string"==typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function l(e,t){if(!s(e)||!s(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,r=e.length;r>n;n++)if(e[n]!==t[n])return!1;return!0}function f(e){return escape(e)}function h(e){return encodeURIComponent(e).replace(/[!'()*]/g,f).replace(/\*/g,"%2A")}function d(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function p(e,t){return function(n,r){return void 0===n?this._parts[e]||"":(null!==n&&(n+="",n.charAt(0)===t&&(n=n.substring(1))),this._parts[e]=n,this.build(!r),this)}}var g=r&&r.URI;i.version="1.14.1";var m=i.prototype,v=Object.prototype.hasOwnProperty;i._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:i.duplicateQueryParameters,escapeQuerySpace:i.escapeQuerySpace}},i.duplicateQueryParameters=!1,i.escapeQuerySpace=!0,i.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,i.idn_expression=/[^a-z0-9\.-]/i,i.punycode_expression=/(xn--)/i,i.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,i.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,i.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,i.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/},i.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},i.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,i.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},i.getDomAttribute=function(e){if(!e||!e.nodeName)return void 0;var t=e.nodeName.toLowerCase();return"input"===t&&"image"!==e.type?void 0:i.domAttributes[t]},i.encode=h,i.decode=decodeURIComponent,i.iso8859=function(){i.encode=escape,i.decode=unescape},i.unicode=function(){i.encode=h,i.decode=decodeURIComponent},i.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}}},i.encodeQuery=function(e,t){var n=i.encode(e+"");return void 0===t&&(t=i.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},i.decodeQuery=function(e,t){e+="",void 0===t&&(t=i.escapeQuerySpace);try{return i.decode(t?e.replace(/\+/g,"%20"):e)}catch(n){return e}},i.recodePath=function(e){for(var t=(e+"").split("/"),n=0,r=t.length;r>n;n++)t[n]=i.encodePathSegment(i.decode(t[n]));return t.join("/")},i.decodePath=function(e){for(var t=(e+"").split("/"),n=0,r=t.length;r>n;n++)t[n]=i.decodePathSegment(t[n]);return t.join("/")};var y,b={encode:"encode",decode:"decode"},_=function(e,t){return function(n){try{return i[t](n+"").replace(i.characters[e][t].expression,function(n){return i.characters[e][t].map[n]})}catch(r){return n}}};for(y in b)i[y+"PathSegment"]=_("pathname",b[y]);i.encodeReserved=_("reserved","encode"),i.parse=function(e,t){var n;return t||(t={}),n=e.indexOf("#"),n>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),n=e.indexOf("?"),n>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),"//"===e.substring(0,2)?(t.protocol=null,e=e.substring(2),e=i.parseAuthority(e,t)):(n=e.indexOf(":"),n>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(i.protocol_expression)?t.protocol=void 0:"//"===e.substring(n+1,n+3)?(e=e.substring(n+3),e=i.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0))),t.path=e,t},i.parseHost=function(e,t){var n,r,i=e.indexOf("/");return-1===i&&(i=e.length),"["===e.charAt(0)?(n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,i)||null,"/"===t.port&&(t.port=null)):e.indexOf(":")!==e.lastIndexOf(":")?(t.hostname=e.substring(0,i)||null,t.port=null):(r=e.substring(0,i).split(":"),t.hostname=r[0]||null,t.port=r[1]||null),t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),e.substring(i)||"/"},i.parseAuthority=function(e,t){return e=i.parseUserinfo(e,t),i.parseHost(e,t)},i.parseUserinfo=function(e,t){var n,r=e.indexOf("/"),o=e.lastIndexOf("@",r>-1?r:e.length-1);return o>-1&&(-1===r||r>o)?(n=e.substring(0,o).split(":"),t.username=n[0]?i.decode(n[0]):null,n.shift(),t.password=n[0]?i.decode(n.join(":")):null,e=e.substring(o+1)):(t.username=null,t.password=null),e},i.parseQuery=function(e,t){if(!e)return{};if(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!e)return{};for(var n,r,o,a={},s=e.split("&"),u=s.length,c=0;u>c;c++)n=s[c].split("="),r=i.decodeQuery(n.shift(),t),o=n.length?i.decodeQuery(n.join("="),t):null,v.call(a,r)?("string"==typeof a[r]&&(a[r]=[a[r]]),a[r].push(o)):a[r]=o;return a},i.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//"),t+=i.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&"string"==typeof e.hostname&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},i.buildHost=function(e){var t="";return e.hostname?(t+=i.ip6_expression.test(e.hostname)?"["+e.hostname+"]":e.hostname,e.port&&(t+=":"+e.port),t):""},i.buildAuthority=function(e){return i.buildUserinfo(e)+i.buildHost(e)},i.buildUserinfo=function(e){var t="";return e.username&&(t+=i.encode(e.username),e.password&&(t+=":"+i.encode(e.password)),t+="@"),t},i.buildQuery=function(e,t,n){var r,o,a,u,c="";for(o in e)if(v.call(e,o)&&o)if(s(e[o]))for(r={},a=0,u=e[o].length;u>a;a++)void 0!==e[o][a]&&void 0===r[e[o][a]+""]&&(c+="&"+i.buildQueryParameter(o,e[o][a],n),t!==!0&&(r[e[o][a]+""]=!0));else void 0!==e[o]&&(c+="&"+i.buildQueryParameter(o,e[o],n));return c.substring(1)},i.buildQueryParameter=function(e,t,n){return i.encodeQuery(e,n)+(null!==t?"="+i.encodeQuery(t,n):"")},i.addQuery=function(e,t,n){if("object"==typeof t)for(var r in t)v.call(t,r)&&i.addQuery(e,r,t[r]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=n);"string"==typeof e[t]&&(e[t]=[e[t]]),s(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},i.removeQuery=function(e,t,n){var r,o,a;if(s(t))for(r=0,o=t.length;o>r;r++)e[t[r]]=void 0;else if("object"==typeof t)for(a in t)v.call(t,a)&&i.removeQuery(e,a,t[a]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the first parameter");void 0!==n?e[t]===n?e[t]=void 0:s(e[t])&&(e[t]=u(e[t],n)):e[t]=void 0}},i.hasQuery=function(e,t,n,r){if("object"==typeof t){for(var o in t)if(v.call(t,o)&&!i.hasQuery(e,o,t[o]))return!1;return!0}if("string"!=typeof t)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(a(n)){case"Undefined":return t in e;case"Boolean":var u=Boolean(s(e[t])?e[t].length:e[t]);return n===u;case"Function":return!!n(e[t],t,e);case"Array":if(!s(e[t]))return!1;var f=r?c:l;return f(e[t],n);case"RegExp":return s(e[t])?r?c(e[t],n):!1:Boolean(e[t]&&e[t].match(n));case"Number":n=String(n);case"String":return s(e[t])?r?c(e[t],n):!1:e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},i.commonPath=function(e,t){var n,r=Math.min(e.length,t.length);for(n=0;r>n;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return 1>n?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":(("/"!==e.charAt(n)||"/"!==t.charAt(n))&&(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},i.withinString=function(e,t,n){n||(n={});var r=n.start||i.findUri.start,o=n.end||i.findUri.end,a=n.trim||i.findUri.trim,s=/[a-z0-9-]=["']?$/i;for(r.lastIndex=0;;){var u=r.exec(e);if(!u)break;var c=u.index;if(n.ignoreHtml){var l=e.slice(Math.max(c-3,0),c);if(l&&s.test(l))continue}var f=c+e.slice(c).search(o),h=e.slice(c,f).replace(a,"");if(!n.ignore||!n.ignore.test(h)){f=c+h.length;var d=t(h,c,f,e);e=e.slice(0,c)+d+e.slice(f),r.lastIndex=c+d.length}}return r.lastIndex=0,e},i.ensureValidHostname=function(t){if(t.match(i.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(e.toASCII(t).match(i.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]')}},i.noConflict=function(e){if(e){var t={URI:this.noConflict()};return r.URITemplate&&"function"==typeof r.URITemplate.noConflict&&(t.URITemplate=r.URITemplate.noConflict()),r.IPv6&&"function"==typeof r.IPv6.noConflict&&(t.IPv6=r.IPv6.noConflict()),r.SecondLevelDomains&&"function"==typeof r.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=r.SecondLevelDomains.noConflict()),t}return r.URI===this&&(r.URI=g),this},m.build=function(e){return e===!0?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=i.build(this._parts),this._deferred_build=!1),this},m.clone=function(){return new i(this)},m.valueOf=m.toString=function(){return this.build(!1)._string},m.protocol=d("protocol"),m.username=d("username"),m.password=d("password"),m.hostname=d("hostname"),m.port=d("port"),m.query=p("query","?"),m.fragment=p("fragment","#"),m.search=function(e,t){var n=this.query(e,t);return"string"==typeof n&&n.length?"?"+n:n},m.hash=function(e,t){var n=this.fragment(e,t);return"string"==typeof n&&n.length?"#"+n:n},m.pathname=function(e,t){if(void 0===e||e===!0){var n=this._parts.path||(this._parts.hostname?"/":"");return e?i.decodePath(n):n}return this._parts.path=e?i.recodePath(e):"/",this.build(!t),this},m.path=m.pathname,m.href=function(e,t){var n;if(void 0===e)return this.toString();this._string="",this._parts=i._parts();var r=e instanceof i,o="object"==typeof e&&(e.hostname||e.path||e.pathname);if(e.nodeName){var a=i.getDomAttribute(e);e=e[a]||"",o=!1}if(!r&&o&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=i.parse(String(e),this._parts);else{if(!r&&!o)throw new TypeError("invalid input");var s=r?e._parts:e;for(n in s)v.call(this._parts,n)&&(this._parts[n]=s[n])}return this.build(!t),this},m.is=function(e){var t=!1,r=!1,o=!1,a=!1,s=!1,u=!1,c=!1,l=!this._parts.urn;switch(this._parts.hostname&&(l=!1,r=i.ip4_expression.test(this._parts.hostname),o=i.ip6_expression.test(this._parts.hostname),t=r||o,a=!t,s=a&&n&&n.has(this._parts.hostname),u=a&&i.idn_expression.test(this._parts.hostname),c=a&&i.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return a;case"sld":return s;case"ip":return t;case"ip4":case"ipv4":case"inet4":return r;case"ip6":case"ipv6":case"inet6":return o;case"idn":return u;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var w=m.protocol,x=m.port,I=m.hostname;m.protocol=function(e,t){if(void 0!==e&&e&&(e=e.replace(/:(\/\/)?$/,""),!e.match(i.protocol_expression)))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return w.call(this,e,t)},m.scheme=m.protocol,m.port=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e&&(0===e&&(e=null),e&&(e+="",":"===e.charAt(0)&&(e=e.substring(1)),e.match(/[^0-9]/))))throw new TypeError('Port "'+e+'" contains characters other than [0-9]');return x.call(this,e,t)},m.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={};i.parseHost(e,n),e=n.hostname}return I.call(this,e,t)},m.host=function(e,t){return this._parts.urn?void 0===e?"":this:void 0===e?this._parts.hostname?i.buildHost(this._parts):"":(i.parseHost(e,this._parts),this.build(!t),this)},m.authority=function(e,t){return this._parts.urn?void 0===e?"":this:void 0===e?this._parts.hostname?i.buildAuthority(this._parts):"":(i.parseAuthority(e,this._parts),this.build(!t),this)},m.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.username)return"";var n=i.buildUserinfo(this._parts);return n.substring(0,n.length-1)}return"@"!==e[e.length-1]&&(e+="@"),i.parseUserinfo(e,this._parts),this.build(!t),this},m.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=i.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},m.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var r=this._parts.hostname.length-this.domain().length,a=this._parts.hostname.substring(0,r),s=new RegExp("^"+o(a));return e&&"."!==e.charAt(e.length-1)&&(e+="."),e&&i.ensureValidHostname(e),this._parts.hostname=this._parts.hostname.replace(s,e),this.build(!t),this},m.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var r=this._parts.hostname.length-this.tld(t).length-1;return r=this._parts.hostname.lastIndexOf(".",r-1)+1,this._parts.hostname.substring(r)||""}if(!e)throw new TypeError("cannot set domain empty");if(i.ensureValidHostname(e),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var a=new RegExp(o(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(a,e)}return this.build(!t),this},m.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(r+1);return t!==!0&&n&&n.list[i.toLowerCase()]?n.get(this._parts.hostname)||i:i}var a;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');a=new RegExp(o(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");a=new RegExp(o(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,e)}return this.build(!t),this},m.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,r=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?i.decodePath(r):r}var a=this._parts.path.length-this.filename().length,s=this._parts.path.substring(0,a),u=new RegExp("^"+o(s));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=i.recodePath(e),this._parts.path=this._parts.path.replace(u,e),this.build(!t),this},m.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),r=this._parts.path.substring(n+1);return e?i.decodePathSegment(r):r}var a=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(a=!0);var s=new RegExp(o(this.filename())+"$");return e=i.recodePath(e),this._parts.path=this._parts.path.replace(s,e),a?this.normalizePath(t):this.build(!t),this},m.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||e===!0){if(!this._parts.path||"/"===this._parts.path)return"";var n,r,a=this.filename(),s=a.lastIndexOf(".");return-1===s?"":(n=a.substring(s+1),r=/^[a-z0-9%]+$/i.test(n)?n:"",e?i.decodePathSegment(r):r)}"."===e.charAt(0)&&(e=e.substring(1));var u,c=this.suffix();if(c)u=new RegExp(e?o(c)+"$":o("."+c)+"$");else{if(!e)return this;this._parts.path+="."+i.recodePath(e)}return u&&(e=i.recodePath(e),this._parts.path=this._parts.path.replace(u,e)),this.build(!t),this},m.segment=function(e,t,n){var r=this._parts.urn?":":"/",i=this.path(),o="/"===i.substring(0,1),a=i.split(r);if(void 0!==e&&"number"!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(o&&a.shift(),0>e&&(e=Math.max(a.length+e,0)),void 0===t)return void 0===e?a:a[e];if(null===e||void 0===a[e])if(s(t)){a=[];for(var u=0,c=t.length;c>u;u++)(t[u].length||a.length&&a[a.length-1].length)&&(a.length&&!a[a.length-1].length&&a.pop(),a.push(t[u]))}else(t||"string"==typeof t)&&(""===a[a.length-1]?a[a.length-1]=t:a.push(t));else t?a[e]=t:a.splice(e,1);return o&&a.unshift(""),this.path(a.join(r),n)},m.segmentCoded=function(e,t,n){var r,o,a;if("number"!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(r=this.segment(e,t,n),s(r))for(o=0,a=r.length;a>o;o++)r[o]=i.decode(r[o]);else r=void 0!==r?i.decode(r):void 0;return r}if(s(t))for(o=0,a=t.length;a>o;o++)t[o]=i.decode(t[o]);else t="string"==typeof t||t instanceof String?i.encode(t):t;return this.segment(e,t,n)};var E=m.query;return m.query=function(e,t){if(e===!0)return i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var n=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace),r=e.call(this,n);return this._parts.query=i.buildQuery(r||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=i.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):E.call(this,e,t)},m.setQuery=function(e,t,n){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)r[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");
for(var o in e)v.call(e,o)&&(r[o]=e[o])}return this._parts.query=i.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},m.addQuery=function(e,t,n){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.addQuery(r,e,void 0===t?null:t),this._parts.query=i.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},m.removeQuery=function(e,t,n){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.removeQuery(r,e,t),this._parts.query=i.buildQuery(r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},m.hasQuery=function(e,t,n){var r=i.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return i.hasQuery(r,e,t,n)},m.setSearch=m.setQuery,m.addSearch=m.addQuery,m.removeSearch=m.removeQuery,m.hasSearch=m.hasQuery,m.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},m.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},m.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},m.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===i.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},m.normalizePath=function(e){if(this._parts.urn)return this;if(!this._parts.path||"/"===this._parts.path)return this;var t,n,r,o=this._parts.path,a="";for("/"!==o.charAt(0)&&(t=!0,o="/"+o),o=o.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(a=o.substring(1).match(/^(\.\.\/)+/)||"",a&&(a=a[0]));;){if(n=o.indexOf("/.."),-1===n)break;0!==n?(r=o.substring(0,n).lastIndexOf("/"),-1===r&&(r=n),o=o.substring(0,r)+o.substring(n+3)):o=o.substring(3)}return t&&this.is("relative")&&(o=a+o.substring(1)),o=i.recodePath(o),this._parts.path=o,this.build(!e),this},m.normalizePathname=m.normalizePath,m.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(i.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},m.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},m.normalizeSearch=m.normalizeQuery,m.normalizeHash=m.normalizeFragment,m.iso8859=function(){var e=i.encode,t=i.decode;return i.encode=escape,i.decode=decodeURIComponent,this.normalize(),i.encode=e,i.decode=t,this},m.unicode=function(){var e=i.encode,t=i.decode;return i.encode=h,i.decode=unescape,this.normalize(),i.encode=e,i.decode=t,this},m.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var r="",o=0,a=t._parts.query.split("&"),s=a.length;s>o;o++){var u=(a[o]||"").split("=");r+="&"+i.decodeQuery(u[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==u[1]&&(r+="="+i.decodeQuery(u[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+r.substring(1)}return n+=i.decodeQuery(t.hash(),!0)},m.absoluteTo=function(e){var t,n,r,o=this.clone(),a=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof i||(e=new i(e)),o._parts.protocol||(o._parts.protocol=e._parts.protocol),this._parts.hostname)return o;for(n=0;r=a[n];n++)o._parts[r]=e._parts[r];return o._parts.path?".."===o._parts.path.substring(-2)&&(o._parts.path+="/"):(o._parts.path=e._parts.path,o._parts.query||(o._parts.query=e._parts.query)),"/"!==o.path().charAt(0)&&(t=e.directory(),o._parts.path=(t?t+"/":"")+o._parts.path,o.normalizePath()),o.build(),o},m.relativeTo=function(e){var t,n,r,o,a,s=this.clone().normalize();if(s._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new i(e).normalize(),t=s._parts,n=e._parts,o=s.path(),a=e.path(),"/"!==o.charAt(0))throw new Error("URI is already relative");if("/"!==a.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password)return s.build();if(null!==t.protocol||null!==t.username||null!==t.password)return s.build();if(t.hostname!==n.hostname||t.port!==n.port)return s.build();if(t.hostname=null,t.port=null,o===a)return t.path="",s.build();if(r=i.commonPath(s.path(),e.path()),!r)return s.build();var u=n.path.substring(r.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=u+t.path.substring(r.length),s.build()},m.equals=function(e){var t,n,r,o=this.clone(),a=new i(e),u={},c={},f={};if(o.normalize(),a.normalize(),o.toString()===a.toString())return!0;if(t=o.query(),n=a.query(),o.query(""),a.query(""),o.toString()!==a.toString())return!1;if(t.length!==n.length)return!1;u=i.parseQuery(t,this._parts.escapeQuerySpace),c=i.parseQuery(n,this._parts.escapeQuerySpace);for(r in u)if(v.call(u,r)){if(s(u[r])){if(!l(u[r],c[r]))return!1}else if(u[r]!==c[r])return!1;f[r]=!0}for(r in c)if(v.call(c,r)&&!f[r])return!1;return!0},m.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},m.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},i})},{"./IPv6":3,"./SecondLevelDomains":4,"./punycode":6}],6:[function(e,t,n){(function(e){!function(r){function i(e){throw RangeError(N[e])}function o(e,t){for(var n=e.length;n--;)e[n]=t(e[n]);return e}function a(e,t){return o(e.split(C),t).join(".")}function s(e){for(var t,n,r=[],i=0,o=e.length;o>i;)t=e.charCodeAt(i++),t>=55296&&56319>=t&&o>i?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function u(e){return o(e,function(e){var t="";return e>65535&&(e-=65536,t+=L(e>>>10&1023|55296),e=56320|1023&e),t+=L(e)}).join("")}function c(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:x}function l(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function f(e,t,n){var r=0;for(e=n?F(e/P):e>>1,e+=F(e/t);e>D*E>>1;r+=x)e=F(e/D);return F(r+(D+1)*e/(e+T))}function h(e){var t,n,r,o,a,s,l,h,d,p,g=[],m=e.length,v=0,y=A,b=S;for(n=e.lastIndexOf(R),0>n&&(n=0),r=0;n>r;++r)e.charCodeAt(r)>=128&&i("not-basic"),g.push(e.charCodeAt(r));for(o=n>0?n+1:0;m>o;){for(a=v,s=1,l=x;o>=m&&i("invalid-input"),h=c(e.charCodeAt(o++)),(h>=x||h>F((w-v)/s))&&i("overflow"),v+=h*s,d=b>=l?I:l>=b+E?E:l-b,!(d>h);l+=x)p=x-d,s>F(w/p)&&i("overflow"),s*=p;t=g.length+1,b=f(v-a,t,0==a),F(v/t)>w-y&&i("overflow"),y+=F(v/t),v%=t,g.splice(v++,0,y)}return u(g)}function d(e){var t,n,r,o,a,u,c,h,d,p,g,m,v,y,b,_=[];for(e=s(e),m=e.length,t=A,n=0,a=S,u=0;m>u;++u)g=e[u],128>g&&_.push(L(g));for(r=o=_.length,o&&_.push(R);m>r;){for(c=w,u=0;m>u;++u)g=e[u],g>=t&&c>g&&(c=g);for(v=r+1,c-t>F((w-n)/v)&&i("overflow"),n+=(c-t)*v,t=c,u=0;m>u;++u)if(g=e[u],t>g&&++n>w&&i("overflow"),g==t){for(h=n,d=x;p=a>=d?I:d>=a+E?E:d-a,!(p>h);d+=x)b=h-p,y=x-p,_.push(L(l(p+b%y,0))),h=F(b/y);_.push(L(l(h,0))),a=f(n,v,r==o),n=0,++r}++n,++t}return _.join("")}function p(e){return a(e,function(e){return k.test(e)?h(e.slice(4).toLowerCase()):e})}function g(e){return a(e,function(e){return O.test(e)?"xn--"+d(e):e})}var m="object"==typeof n&&n,v="object"==typeof t&&t&&t.exports==m&&t,y="object"==typeof e&&e;(y.global===y||y.window===y)&&(r=y);var b,_,w=2147483647,x=36,I=1,E=26,T=38,P=700,S=72,A=128,R="-",k=/^xn--/,O=/[^ -~]/,C=/\x2E|\u3002|\uFF0E|\uFF61/g,N={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},D=x-I,F=Math.floor,L=String.fromCharCode;if(b={version:"1.2.3",ucs2:{decode:s,encode:u},decode:h,encode:d,toASCII:g,toUnicode:p},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return b});else if(m&&!m.nodeType)if(v)v.exports=b;else for(_ in b)b.hasOwnProperty(_)&&(m[_]=b[_]);else r.punycode=b}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,n){!function(t,r){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(e,n,i){t.Backbone=r(t,i,e,n)});else if("undefined"!=typeof n){var i=e("underscore");r(t,n,i)}else t.Backbone=r(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(this,function(e,t,n,r){{var i=e.Backbone,o=[],a=(o.push,o.slice);o.splice}t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,o=n.once(function(){i.off(e,o),t.apply(this,arguments)});return o._callback=t,this.on(e,o,r)},off:function(e,t,r){var i,o,a,s,u,l,f,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;for(s=e?[e]:n.keys(this._events),u=0,l=s.length;l>u;u++)if(e=s[u],a=this._events[e]){if(this._events[e]=i=[],t||r)for(f=0,h=a.length;h>f;f++)o=a[f],(t&&t!==o.callback&&t!==o.callback._callback||r&&r!==o.context)&&i.push(o);i.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&l(n,t),r&&l(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var o=!t&&!r;r||"object"!=typeof t||(r=this),e&&((i={})[e._listenId]=e);for(var a in i)e=i[a],e.off(t,r,this),(o||n.isEmpty(e._events))&&delete this._listeningTo[a];return this}},u=/\s+/,c=function(e,t,n,r){if(!n)return!0;if("object"==typeof n){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(u.test(n)){for(var o=n.split(u),a=0,s=o.length;s>a;a++)e[t].apply(e,[o[a]].concat(r));return!1}return!0},l=function(e,t){var n,r=-1,i=e.length,o=t[0],a=t[1],s=t[2];switch(t.length){case 0:for(;++r<i;)(n=e[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o);return;case 2:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a);return;case 3:for(;++r<i;)(n=e[r]).callback.call(n.ctx,o,a,s);return;default:for(;++r<i;)(n=e[r]).callback.apply(n.ctx,t);return}},f={listenTo:"on",listenToOnce:"once"};n.each(f,function(e,t){s[t]=function(t,r,i){var o=this._listeningTo||(this._listeningTo={}),a=t._listenId||(t._listenId=n.uniqueId("l"));return o[a]=t,i||"object"!=typeof r||(i=this),t[e](r,i,this),this}}),s.bind=s.on,s.unbind=s.off,n.extend(t,s);var h=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(h.prototype,s,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,r){var i,o,a,s,u,c,l,f;if(null==e)return this;if("object"==typeof e?(o=e,r=t):(o={})[e]=t,r||(r={}),!this._validate(o,r))return!1;a=r.unset,u=r.silent,s=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={}),f=this.attributes,l=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(i in o)t=o[i],n.isEqual(f[i],t)||s.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,a?delete f[i]:f[i]=t;if(!u){s.length&&(this._pending=r);for(var h=0,d=s.length;d>h;h++)this.trigger("change:"+s[h],this,f[s[h]],r)}if(c)return this;if(!u)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var o in e)n.isEqual(i[o],t=e[o])||((r||(r={}))[o]=t);return r},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){return t.set(t.parse(n,e),e)?(r&&r(t,n,e),void t.trigger("sync",t,n,e)):!1},j(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,o,a,s=this.attributes;if(null==e||"object"==typeof e?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r),i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},s,i)),void 0===r.parse&&(r.parse=!0);var u=this,c=r.success;return r.success=function(e){u.attributes=s;var t=u.parse(e,r);return r.wait&&(t=n.extend(i||{},t)),n.isObject(t)&&!u.set(t,r)?!1:(c&&c(u,e,r),void u.trigger("sync",u,e,r))},j(this,r),o=this.isNew()?"create":r.patch?"patch":"update","patch"===o&&(r.attrs=i),a=this.sync(o,this,r),i&&r.wait&&(this.attributes=s),a},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)},this.isNew())return e.success(),!1;j(this,e);var o=this.sync("delete",this,e);return e.wait||i(),o},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||L();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var d=["keys","values","pairs","invert","pick","omit"];n.each(d,function(e){h.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var p=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};n.extend(p.prototype,s,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,m))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,o,a,s;for(i=0,o=e.length;o>i;i++)s=e[i]=this.get(e[i]),s&&(delete this._byId[s.id],delete this._byId[s.cid],a=this.indexOf(s),this.models.splice(a,1),this.length--,t.silent||(t.index=a,s.trigger("remove",s,this,t)),this._removeReference(s,t));return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,o,a,s,u,c,l,f=t.at,d=this.model,p=this.comparator&&null==f&&t.sort!==!1,m=n.isString(this.comparator)?this.comparator:null,v=[],y=[],b={},_=t.add,w=t.merge,x=t.remove,I=!p&&_&&x?[]:!1;for(i=0,o=e.length;o>i;i++){if(u=e[i]||{},a=u instanceof h?s=u:u[d.prototype.idAttribute||"id"],c=this.get(a))x&&(b[c.cid]=!0),w&&(u=u===s?s.attributes:u,t.parse&&(u=c.parse(u,t)),c.set(u,t),p&&!l&&c.hasChanged(m)&&(l=!0)),e[i]=c;else if(_){if(s=e[i]=this._prepareModel(u,t),!s)continue;v.push(s),this._addReference(s,t)}s=c||s,!I||!s.isNew()&&b[s.id]||I.push(s),b[s.id]=!0}if(x){for(i=0,o=this.length;o>i;++i)b[(s=this.models[i]).cid]||y.push(s);y.length&&this.remove(y,t)}if(v.length||I&&I.length)if(p&&(l=!0),this.length+=v.length,null!=f)for(i=0,o=v.length;o>i;i++)this.models.splice(f+i,0,v[i]);else{I&&(this.models.length=0);var E=I||v;for(i=0,o=E.length;o>i;i++)this.models.push(E[i])}if(l&&this.sort({silent:!0}),!t.silent){for(i=0,o=v.length;o>i;i++)(s=v[i]).trigger("add",s,this,t);(l||I&&I.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;i>r;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return a.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},j(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?n.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(v,function(e){p.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var y=["groupBy","countBy","sortBy","indexBy"];n.each(y,function(e){p.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var b=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,w)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},_=/^(\S+)\s*(.*)$/,w=["model","collection","el","id","attributes","className","tagName","events"];n.extend(b.prototype,s,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];if(n.isFunction(r)||(r=this[e[t]]),r){var i=t.match(_),o=i[1],a=i[2];r=n.bind(r,this),o+=".delegateEvents"+this.cid,""===a?this.$el.on(o,r):this.$el.on(o,a,r)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}}}),t.sync=function(e,r,i){var o=I[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:o,dataType:"json"};if(i.url||(a.url=n.result(r,"url")||L()),null!=i.data||!r||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),i.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){a.type="POST",i.emulateJSON&&(a.data._method=o);var s=i.beforeSend;i.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",o),s?s.apply(this,arguments):void 0}}"GET"===a.type||i.emulateJSON||(a.processData=!1),"PATCH"===a.type&&x&&(a.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var u=i.xhr=t.ajax(n.extend(a,i));return r.trigger("request",r,u,i),u};var x=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),I={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var E=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},T=/\((.*?)\)/g,P=/(\(\?)?:\w+/g,S=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(E.prototype,s,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var o=this;return t.history.route(e,function(n){var a=o._extractParameters(e,n);o.execute(i,a),o.trigger.apply(o,["route:"+r].concat(a)),o.trigger("route",r,a),t.history.trigger("route",o,r,a)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(T,"(?:$1)?").replace(P,function(e,t){return t?e:"([^/?]+)"}).replace(S,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var R=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},k=/^[#\/]|\s+$/g,O=/^\/+|\/+$/g,C=/msie [\w.]+/,N=/\/$/,D=/#.*$/;R.started=!1,n.extend(R.prototype,s,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(N,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(k,"")},start:function(e){if(R.started)throw new Error("Backbone.history has already been started");R.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,o=C.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);if(this.root=("/"+this.root+"/").replace(O,"/"),o&&this._wantsHashChange){var a=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var s=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&s.hash&&(this.fragment=this.getHash().replace(k,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),R.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(e,t){if(!R.started)return!1;t&&t!==!0||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(D,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new R;var F=function(e,t){var r,i=this;r=e&&n.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)},n.extend(r,i,t);var o=function(){this.constructor=r};return o.prototype=i.prototype,r.prototype=new o,e&&n.extend(r.prototype,e),r.__super__=i.prototype,r};h.extend=p.extend=E.extend=b.extend=R.extend=F;var L=function(){throw new Error('A "url" property or function must be specified')},j=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t})},{underscore:10}],8:[function(e,t){function n(){if(!a){a=!0;for(var e,t=o.length;t;){e=o,o=[];for(var n=-1;++n<t;)e[n]();t=o.length}a=!1}}function r(){}var i=t.exports={},o=[],a=!1;i.nextTick=function(e){o.push(e),a||setTimeout(n,0)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.on=r,i.addListener=r,i.once=r,i.off=r,i.removeListener=r,i.removeAllListeners=r,i.emit=r,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],9:[function(e,t,n){(function(){var e,t,r,i,o,a,s,u,c,l,f,h,d,p,g=[].slice;o="3.0.0",t="pending",i="resolved",r="rejected",c=function(e,t){return null!=e?e.hasOwnProperty(t):void 0},f=function(e){return c(e,"length")&&c(e,"callee")},h=function(e){return c(e,"promise")&&"function"==typeof(null!=e?e.promise:void 0)},u=function(e){return f(e)?u(Array.prototype.slice.call(e)):Array.isArray(e)?e.reduce(function(e,t){return Array.isArray(t)?e.concat(u(t)):(e.push(t),e)},[]):[e]},a=function(e,t){return 0>=e?t():function(){return--e<1?t.apply(this,arguments):void 0}},d=function(e,t){return function(){var n;return n=[e].concat(Array.prototype.slice.call(arguments,0)),t.apply(this,n)}},s=function(e,t,n){var r,i,o,a,s;for(a=u(e),s=[],i=0,o=a.length;o>i;i++)r=a[i],s.push(r.call.apply(r,[n].concat(g.call(t))));return s},e=function(){var n,o,a,c,l,f,d;return d=t,c=[],l=[],f=[],a={resolved:{},rejected:{},pending:{}},this.promise=function(n){var o,p;return n=n||{},n.state=function(){return d},p=function(e,r,i){return function(){return d===t&&r.push.apply(r,u(arguments)),e()&&s(arguments,a[i]),n}},n.done=p(function(){return d===i},c,i),n.fail=p(function(){return d===r},l,r),n.progress=p(function(){return d!==t},f,t),n.always=function(){var e;return(e=n.done.apply(n,arguments)).fail.apply(e,arguments)},o=function(t,r,i){var o,a;return a=new e,o=function(e,t,r){return n[e](r?function(){var e,n;return e=1<=arguments.length?g.call(arguments,0):[],n=r.apply(null,e),h(n)?n.done(a.resolve).fail(a.reject).progress(a.notify):a[t](n)}:a[t])},o("done","resolve",t),o("fail","reject",r),o("progress","notify",i),a},n.pipe=o,n.then=o,null==n.promise&&(n.promise=function(){return n}),n},this.promise(this),n=this,o=function(e,r,i){return function(){return d===t?(d=e,a[e]=arguments,s(r,a[e],i),n):this}},this.resolve=o(i,c),this.reject=o(r,l),this.notify=o(t,f),this.resolveWith=function(e,t){return o(i,c,e).apply(null,t)},this.rejectWith=function(e,t){return o(r,l,e).apply(null,t)},this.notifyWith=function(e,n){return o(t,f,e).apply(null,n)},this},p=function(){var t,n,r,i,o,s,c;if(n=u(arguments),1===n.length)return h(n[0])?n[0]:(new e).resolve(n[0]).promise();if(o=new e,!n.length)return o.resolve().promise();for(i=[],r=a(n.length,function(){return o.resolve.apply(o,i)}),n.forEach(function(e,t){return h(e)?e.done(function(){var e;return e=1<=arguments.length?g.call(arguments,0):[],i[t]=e.length>1?e:e[0],r()}):(i[t]=e,r())}),s=0,c=n.length;c>s;s++)t=n[s],h(t)&&t.fail(o.reject);return o.promise()},l=function(t){return t.Deferred=function(){return new e},t.ajax=d(t.ajax,function(t,n){var r,i,o,a;return null==n&&(n={}),i=new e,r=function(e,t){return d(e,function(){var e,n;return n=arguments[0],e=2<=arguments.length?g.call(arguments,1):[],n&&n.apply(null,e),t.apply(null,e)})},n.success=r(n.success,i.resolve),n.error=r(n.error,i.reject),a=t(n),o=i.promise(),o.abort=function(){return a.abort()},o}),t.when=p},"undefined"!=typeof n?(n.Deferred=function(){return new e},n.when=p,n.installInto=l):"function"==typeof define&&define.amd?define(function(){return"undefined"!=typeof Zepto?l(Zepto):(e.when=p,e.installInto=l,e)}):"undefined"!=typeof Zepto?l(Zepto):(this.Deferred=function(){return new e},this.Deferred.when=p,this.Deferred.installInto=l)}).call(this)},{}],10:[function(e,t,n){(function(){var e=this,r=e._,i=Array.prototype,o=Object.prototype,a=Function.prototype,s=i.push,u=i.slice,c=i.concat,l=o.toString,f=o.hasOwnProperty,h=Array.isArray,d=Object.keys,p=a.bind,g=function(e){return e instanceof g?e:this instanceof g?void(this._wrapped=e):new g(e)
};"undefined"!=typeof n?("undefined"!=typeof t&&t.exports&&(n=t.exports=g),n._=g):e._=g,g.VERSION="1.7.0";var m=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return function(){return e.apply(t,arguments)}};g.iteratee=function(e,t,n){return null==e?g.identity:g.isFunction(e)?m(e,t,n):g.isObject(e)?g.matches(e):g.property(e)},g.each=g.forEach=function(e,t,n){if(null==e)return e;t=m(t,n);var r,i=e.length;if(i===+i)for(r=0;i>r;r++)t(e[r],r,e);else{var o=g.keys(e);for(r=0,i=o.length;i>r;r++)t(e[o[r]],o[r],e)}return e},g.map=g.collect=function(e,t,n){if(null==e)return[];t=g.iteratee(t,n);for(var r,i=e.length!==+e.length&&g.keys(e),o=(i||e).length,a=Array(o),s=0;o>s;s++)r=i?i[s]:s,a[s]=t(e[r],r,e);return a};var v="Reduce of empty array with no initial value";g.reduce=g.foldl=g.inject=function(e,t,n,r){null==e&&(e=[]),t=m(t,r,4);var i,o=e.length!==+e.length&&g.keys(e),a=(o||e).length,s=0;if(arguments.length<3){if(!a)throw new TypeError(v);n=e[o?o[s++]:s++]}for(;a>s;s++)i=o?o[s]:s,n=t(n,e[i],i,e);return n},g.reduceRight=g.foldr=function(e,t,n,r){null==e&&(e=[]),t=m(t,r,4);var i,o=e.length!==+e.length&&g.keys(e),a=(o||e).length;if(arguments.length<3){if(!a)throw new TypeError(v);n=e[o?o[--a]:--a]}for(;a--;)i=o?o[a]:a,n=t(n,e[i],i,e);return n},g.find=g.detect=function(e,t,n){var r;return t=g.iteratee(t,n),g.some(e,function(e,n,i){return t(e,n,i)?(r=e,!0):void 0}),r},g.filter=g.select=function(e,t,n){var r=[];return null==e?r:(t=g.iteratee(t,n),g.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r)},g.reject=function(e,t,n){return g.filter(e,g.negate(g.iteratee(t)),n)},g.every=g.all=function(e,t,n){if(null==e)return!0;t=g.iteratee(t,n);var r,i,o=e.length!==+e.length&&g.keys(e),a=(o||e).length;for(r=0;a>r;r++)if(i=o?o[r]:r,!t(e[i],i,e))return!1;return!0},g.some=g.any=function(e,t,n){if(null==e)return!1;t=g.iteratee(t,n);var r,i,o=e.length!==+e.length&&g.keys(e),a=(o||e).length;for(r=0;a>r;r++)if(i=o?o[r]:r,t(e[i],i,e))return!0;return!1},g.contains=g.include=function(e,t){return null==e?!1:(e.length!==+e.length&&(e=g.values(e)),g.indexOf(e,t)>=0)},g.invoke=function(e,t){var n=u.call(arguments,2),r=g.isFunction(t);return g.map(e,function(e){return(r?t:e[t]).apply(e,n)})},g.pluck=function(e,t){return g.map(e,g.property(t))},g.where=function(e,t){return g.filter(e,g.matches(t))},g.findWhere=function(e,t){return g.find(e,g.matches(t))},g.max=function(e,t,n){var r,i,o=-1/0,a=-1/0;if(null==t&&null!=e){e=e.length===+e.length?e:g.values(e);for(var s=0,u=e.length;u>s;s++)r=e[s],r>o&&(o=r)}else t=g.iteratee(t,n),g.each(e,function(e,n,r){i=t(e,n,r),(i>a||i===-1/0&&o===-1/0)&&(o=e,a=i)});return o},g.min=function(e,t,n){var r,i,o=1/0,a=1/0;if(null==t&&null!=e){e=e.length===+e.length?e:g.values(e);for(var s=0,u=e.length;u>s;s++)r=e[s],o>r&&(o=r)}else t=g.iteratee(t,n),g.each(e,function(e,n,r){i=t(e,n,r),(a>i||1/0===i&&1/0===o)&&(o=e,a=i)});return o},g.shuffle=function(e){for(var t,n=e&&e.length===+e.length?e:g.values(e),r=n.length,i=Array(r),o=0;r>o;o++)t=g.random(0,o),t!==o&&(i[o]=i[t]),i[t]=n[o];return i},g.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=g.values(e)),e[g.random(e.length-1)]):g.shuffle(e).slice(0,Math.max(0,t))},g.sortBy=function(e,t,n){return t=g.iteratee(t,n),g.pluck(g.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index-t.index}),"value")};var y=function(e){return function(t,n,r){var i={};return n=g.iteratee(n,r),g.each(t,function(r,o){var a=n(r,o,t);e(i,r,a)}),i}};g.groupBy=y(function(e,t,n){g.has(e,n)?e[n].push(t):e[n]=[t]}),g.indexBy=y(function(e,t,n){e[n]=t}),g.countBy=y(function(e,t,n){g.has(e,n)?e[n]++:e[n]=1}),g.sortedIndex=function(e,t,n,r){n=g.iteratee(n,r,1);for(var i=n(t),o=0,a=e.length;a>o;){var s=o+a>>>1;n(e[s])<i?o=s+1:a=s}return o},g.toArray=function(e){return e?g.isArray(e)?u.call(e):e.length===+e.length?g.map(e,g.identity):g.values(e):[]},g.size=function(e){return null==e?0:e.length===+e.length?e.length:g.keys(e).length},g.partition=function(e,t,n){t=g.iteratee(t,n);var r=[],i=[];return g.each(e,function(e,n,o){(t(e,n,o)?r:i).push(e)}),[r,i]},g.first=g.head=g.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:u.call(e,0,t)},g.initial=function(e,t,n){return u.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},g.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},g.rest=g.tail=g.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},g.compact=function(e){return g.filter(e,g.identity)};var b=function(e,t,n,r){if(t&&g.every(e,g.isArray))return c.apply(r,e);for(var i=0,o=e.length;o>i;i++){var a=e[i];g.isArray(a)||g.isArguments(a)?t?s.apply(r,a):b(a,t,n,r):n||r.push(a)}return r};g.flatten=function(e,t){return b(e,t,!1,[])},g.without=function(e){return g.difference(e,u.call(arguments,1))},g.uniq=g.unique=function(e,t,n,r){if(null==e)return[];g.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=g.iteratee(n,r));for(var i=[],o=[],a=0,s=e.length;s>a;a++){var u=e[a];if(t)a&&o===u||i.push(u),o=u;else if(n){var c=n(u,a,e);g.indexOf(o,c)<0&&(o.push(c),i.push(u))}else g.indexOf(i,u)<0&&i.push(u)}return i},g.union=function(){return g.uniq(b(arguments,!0,!0,[]))},g.intersection=function(e){if(null==e)return[];for(var t=[],n=arguments.length,r=0,i=e.length;i>r;r++){var o=e[r];if(!g.contains(t,o)){for(var a=1;n>a&&g.contains(arguments[a],o);a++);a===n&&t.push(o)}}return t},g.difference=function(e){var t=b(u.call(arguments,1),!0,!0,[]);return g.filter(e,function(e){return!g.contains(t,e)})},g.zip=function(e){if(null==e)return[];for(var t=g.max(arguments,"length").length,n=Array(t),r=0;t>r;r++)n[r]=g.pluck(arguments,r);return n},g.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},g.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=g.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}for(;i>r;r++)if(e[r]===t)return r;return-1},g.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=e.length;for("number"==typeof n&&(r=0>n?r+n+1:Math.min(r,n+1));--r>=0;)if(e[r]===t)return r;return-1},g.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;r>o;o++,e+=n)i[o]=e;return i};var _=function(){};g.bind=function(e,t){var n,r;if(p&&e.bind===p)return p.apply(e,u.call(arguments,1));if(!g.isFunction(e))throw new TypeError("Bind must be called on a function");return n=u.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,n.concat(u.call(arguments)));_.prototype=e.prototype;var i=new _;_.prototype=null;var o=e.apply(i,n.concat(u.call(arguments)));return g.isObject(o)?o:i}},g.partial=function(e){var t=u.call(arguments,1);return function(){for(var n=0,r=t.slice(),i=0,o=r.length;o>i;i++)r[i]===g&&(r[i]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},g.bindAll=function(e){var t,n,r=arguments.length;if(1>=r)throw new Error("bindAll must be passed function names");for(t=1;r>t;t++)n=arguments[t],e[n]=g.bind(e[n],e);return e},g.memoize=function(e,t){var n=function(r){var i=n.cache,o=t?t.apply(this,arguments):r;return g.has(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return n.cache={},n},g.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},g.defer=function(e){return g.delay.apply(g,[e,1].concat(u.call(arguments,1)))},g.throttle=function(e,t,n){var r,i,o,a=null,s=0;n||(n={});var u=function(){s=n.leading===!1?0:g.now(),a=null,o=e.apply(r,i),a||(r=i=null)};return function(){var c=g.now();s||n.leading!==!1||(s=c);var l=t-(c-s);return r=this,i=arguments,0>=l||l>t?(clearTimeout(a),a=null,s=c,o=e.apply(r,i),a||(r=i=null)):a||n.trailing===!1||(a=setTimeout(u,l)),o}},g.debounce=function(e,t,n){var r,i,o,a,s,u=function(){var c=g.now()-a;t>c&&c>0?r=setTimeout(u,t-c):(r=null,n||(s=e.apply(o,i),r||(o=i=null)))};return function(){o=this,i=arguments,a=g.now();var c=n&&!r;return r||(r=setTimeout(u,t)),c&&(s=e.apply(o,i),o=i=null),s}},g.wrap=function(e,t){return g.partial(t,e)},g.negate=function(e){return function(){return!e.apply(this,arguments)}},g.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},g.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},g.before=function(e,t){var n;return function(){return--e>0?n=t.apply(this,arguments):t=null,n}},g.once=g.partial(g.before,2),g.keys=function(e){if(!g.isObject(e))return[];if(d)return d(e);var t=[];for(var n in e)g.has(e,n)&&t.push(n);return t},g.values=function(e){for(var t=g.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=e[t[i]];return r},g.pairs=function(e){for(var t=g.keys(e),n=t.length,r=Array(n),i=0;n>i;i++)r[i]=[t[i],e[t[i]]];return r},g.invert=function(e){for(var t={},n=g.keys(e),r=0,i=n.length;i>r;r++)t[e[n[r]]]=n[r];return t},g.functions=g.methods=function(e){var t=[];for(var n in e)g.isFunction(e[n])&&t.push(n);return t.sort()},g.extend=function(e){if(!g.isObject(e))return e;for(var t,n,r=1,i=arguments.length;i>r;r++){t=arguments[r];for(n in t)f.call(t,n)&&(e[n]=t[n])}return e},g.pick=function(e,t,n){var r,i={};if(null==e)return i;if(g.isFunction(t)){t=m(t,n);for(r in e){var o=e[r];t(o,r,e)&&(i[r]=o)}}else{var a=c.apply([],u.call(arguments,1));e=new Object(e);for(var s=0,l=a.length;l>s;s++)r=a[s],r in e&&(i[r]=e[r])}return i},g.omit=function(e,t,n){if(g.isFunction(t))t=g.negate(t);else{var r=g.map(c.apply([],u.call(arguments,1)),String);t=function(e,t){return!g.contains(r,t)}}return g.pick(e,t,n)},g.defaults=function(e){if(!g.isObject(e))return e;for(var t=1,n=arguments.length;n>t;t++){var r=arguments[t];for(var i in r)void 0===e[i]&&(e[i]=r[i])}return e},g.clone=function(e){return g.isObject(e)?g.isArray(e)?e.slice():g.extend({},e):e},g.tap=function(e,t){return t(e),e};var w=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof g&&(e=e._wrapped),t instanceof g&&(t=t._wrapped);var i=l.call(e);if(i!==l.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]===e)return r[o]===t;var a=e.constructor,s=t.constructor;if(a!==s&&"constructor"in e&&"constructor"in t&&!(g.isFunction(a)&&a instanceof a&&g.isFunction(s)&&s instanceof s))return!1;n.push(e),r.push(t);var u,c;if("[object Array]"===i){if(u=e.length,c=u===t.length)for(;u--&&(c=w(e[u],t[u],n,r)););}else{var f,h=g.keys(e);if(u=h.length,c=g.keys(t).length===u)for(;u--&&(f=h[u],c=g.has(t,f)&&w(e[f],t[f],n,r)););}return n.pop(),r.pop(),c};g.isEqual=function(e,t){return w(e,t,[],[])},g.isEmpty=function(e){if(null==e)return!0;if(g.isArray(e)||g.isString(e)||g.isArguments(e))return 0===e.length;for(var t in e)if(g.has(e,t))return!1;return!0},g.isElement=function(e){return!(!e||1!==e.nodeType)},g.isArray=h||function(e){return"[object Array]"===l.call(e)},g.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},g.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){g["is"+e]=function(t){return l.call(t)==="[object "+e+"]"}}),g.isArguments(arguments)||(g.isArguments=function(e){return g.has(e,"callee")}),"function"!=typeof/./&&(g.isFunction=function(e){return"function"==typeof e||!1}),g.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},g.isNaN=function(e){return g.isNumber(e)&&e!==+e},g.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===l.call(e)},g.isNull=function(e){return null===e},g.isUndefined=function(e){return void 0===e},g.has=function(e,t){return null!=e&&f.call(e,t)},g.noConflict=function(){return e._=r,this},g.identity=function(e){return e},g.constant=function(e){return function(){return e}},g.noop=function(){},g.property=function(e){return function(t){return t[e]}},g.matches=function(e){var t=g.pairs(e),n=t.length;return function(e){if(null==e)return!n;e=new Object(e);for(var r=0;n>r;r++){var i=t[r],o=i[0];if(i[1]!==e[o]||!(o in e))return!1}return!0}},g.times=function(e,t,n){var r=Array(Math.max(0,e));t=m(t,n,1);for(var i=0;e>i;i++)r[i]=t(i);return r},g.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},g.now=Date.now||function(){return(new Date).getTime()};var x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=g.invert(x),E=function(e){var t=function(t){return e[t]},n="(?:"+g.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};g.escape=E(x),g.unescape=E(I),g.result=function(e,t){if(null==e)return void 0;var n=e[t];return g.isFunction(n)?e[t]():n};var T=0;g.uniqueId=function(e){var t=++T+"";return e?e+t:t},g.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,S={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},A=/\\|'|\r|\n|\u2028|\u2029/g,R=function(e){return"\\"+S[e]};g.template=function(e,t,n){!t&&n&&(t=n),t=g.defaults({},t,g.templateSettings);var r=RegExp([(t.escape||P).source,(t.interpolate||P).source,(t.evaluate||P).source].join("|")+"|$","g"),i=0,o="__p+='";e.replace(r,function(t,n,r,a,s){return o+=e.slice(i,s).replace(A,R),i=s+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(o+="';\n"+a+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var a=new Function(t.variable||"obj","_",o)}catch(s){throw s.source=o,s}var u=function(e){return a.call(this,e,g)},c=t.variable||"obj";return u.source="function("+c+"){\n"+o+"}",u},g.chain=function(e){var t=g(e);return t._chain=!0,t};var k=function(e){return this._chain?g(e).chain():e};g.mixin=function(e){g.each(g.functions(e),function(t){var n=g[t]=e[t];g.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),k.call(this,n.apply(g,e))}})},g.mixin(g),g.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];g.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],k.call(this,n)}}),g.each(["concat","join","slice"],function(e){var t=i[e];g.prototype[e]=function(){return k.call(this,t.apply(this._wrapped,arguments))}}),g.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return g})}).call(this)},{}],11:[function(e,t){var n=function(){function e(e){return null==e?String(e):Q[G.call(e)]||"object"}function t(t){return"function"==e(t)}function n(e){return null!=e&&e==e.window}function r(e){return null!=e&&e.nodeType==e.DOCUMENT_NODE}function i(t){return"object"==e(t)}function o(e){return i(e)&&!n(e)&&Object.getPrototypeOf(e)==Object.prototype}function a(e){return"number"==typeof e.length}function s(e){return R.call(e,function(e){return null!=e})}function u(e){return e.length>0?I.fn.concat.apply([],e):e}function c(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function l(e){return e in C?C[e]:C[e]=new RegExp("(^|\\s)"+e+"(\\s|$)")}function f(e,t){return"number"!=typeof t||N[c(e)]?t:t+"px"}function h(e){var t,n;return O[e]||(t=k.createElement(e),k.body.appendChild(t),n=getComputedStyle(t,"").getPropertyValue("display"),t.parentNode.removeChild(t),"none"==n&&(n="block"),O[e]=n),O[e]}function d(e){return"children"in e?A.call(e.children):I.map(e.childNodes,function(e){return 1==e.nodeType?e:void 0})}function p(e,t,n){for(x in t)n&&(o(t[x])||J(t[x]))?(o(t[x])&&!o(e[x])&&(e[x]={}),J(t[x])&&!J(e[x])&&(e[x]=[]),p(e[x],t[x],n)):t[x]!==w&&(e[x]=t[x])}function g(e,t){return null==t?I(e):I(e).filter(t)}function m(e,n,r,i){return t(n)?n.call(e,r,i):n}function v(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function y(e,t){var n=e.className||"",r=n&&n.baseVal!==w;return t===w?r?n.baseVal:n:void(r?n.baseVal=t:e.className=t)}function b(e){try{return e?"true"==e||("false"==e?!1:"null"==e?null:+e+""==e?+e:/^[\[\{]/.test(e)?I.parseJSON(e):e):e}catch(t){return e}}function _(e,t){t(e);for(var n=0,r=e.childNodes.length;r>n;n++)_(e.childNodes[n],t)}var w,x,I,E,T,P,S=[],A=S.slice,R=S.filter,k=window.document,O={},C={},N={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},D=/^\s*<(\w+|!)[^>]*>/,F=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,L=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,j=/^(?:body|html)$/i,z=/([A-Z])/g,U=["val","css","html","text","data","width","height","offset"],M=["after","prepend","before","append"],B=k.createElement("table"),V=k.createElement("tr"),q={tr:k.createElement("tbody"),tbody:B,thead:B,tfoot:B,td:V,th:V,"*":k.createElement("div")},H=/complete|loaded|interactive/,$=/^[\w-]*$/,Q={},G=Q.toString,W={},Z=k.createElement("div"),X={tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},J=Array.isArray||function(e){return e instanceof Array};return W.matches=function(e,t){if(!t||!e||1!==e.nodeType)return!1;var n=e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.matchesSelector;if(n)return n.call(e,t);var r,i=e.parentNode,o=!i;return o&&(i=Z).appendChild(e),r=~W.qsa(i,t).indexOf(e),o&&Z.removeChild(e),r},T=function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},P=function(e){return R.call(e,function(t,n){return e.indexOf(t)==n})},W.fragment=function(e,t,n){var r,i,a;return F.test(e)&&(r=I(k.createElement(RegExp.$1))),r||(e.replace&&(e=e.replace(L,"<$1></$2>")),t===w&&(t=D.test(e)&&RegExp.$1),t in q||(t="*"),a=q[t],a.innerHTML=""+e,r=I.each(A.call(a.childNodes),function(){a.removeChild(this)})),o(n)&&(i=I(r),I.each(n,function(e,t){U.indexOf(e)>-1?i[e](t):i.attr(e,t)})),r},W.Z=function(e,t){return e=e||[],e.__proto__=I.fn,e.selector=t||"",e},W.isZ=function(e){return e instanceof W.Z},W.init=function(e,n){var r;if(!e)return W.Z();if("string"==typeof e)if(e=e.trim(),"<"==e[0]&&D.test(e))r=W.fragment(e,RegExp.$1,n),e=null;else{if(n!==w)return I(n).find(e);r=W.qsa(k,e)}else{if(t(e))return I(k).ready(e);if(W.isZ(e))return e;if(J(e))r=s(e);else if(i(e))r=[e],e=null;else if(D.test(e))r=W.fragment(e.trim(),RegExp.$1,n),e=null;else{if(n!==w)return I(n).find(e);r=W.qsa(k,e)}}return W.Z(r,e)},I=function(e,t){return W.init(e,t)},I.extend=function(e){var t,n=A.call(arguments,1);return"boolean"==typeof e&&(t=e,e=n.shift()),n.forEach(function(n){p(e,n,t)}),e},W.qsa=function(e,t){var n,i="#"==t[0],o=!i&&"."==t[0],a=i||o?t.slice(1):t,s=$.test(a);return r(e)&&s&&i?(n=e.getElementById(a))?[n]:[]:1!==e.nodeType&&9!==e.nodeType?[]:A.call(s&&!i?o?e.getElementsByClassName(a):e.getElementsByTagName(t):e.querySelectorAll(t))},I.contains=k.documentElement.contains?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t&&(t=t.parentNode);)if(t===e)return!0;return!1},I.type=e,I.isFunction=t,I.isWindow=n,I.isArray=J,I.isPlainObject=o,I.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},I.inArray=function(e,t,n){return S.indexOf.call(t,e,n)},I.camelCase=T,I.trim=function(e){return null==e?"":String.prototype.trim.call(e)},I.uuid=0,I.support={},I.expr={},I.map=function(e,t){var n,r,i,o=[];if(a(e))for(r=0;r<e.length;r++)n=t(e[r],r),null!=n&&o.push(n);else for(i in e)n=t(e[i],i),null!=n&&o.push(n);return u(o)},I.each=function(e,t){var n,r;if(a(e)){for(n=0;n<e.length;n++)if(t.call(e[n],n,e[n])===!1)return e}else for(r in e)if(t.call(e[r],r,e[r])===!1)return e;return e},I.grep=function(e,t){return R.call(e,t)},window.JSON&&(I.parseJSON=JSON.parse),I.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Q["[object "+t+"]"]=t.toLowerCase()}),I.fn={forEach:S.forEach,reduce:S.reduce,push:S.push,sort:S.sort,indexOf:S.indexOf,concat:S.concat,map:function(e){return I(I.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return I(A.apply(this,arguments))},ready:function(e){return H.test(k.readyState)&&k.body?e(I):k.addEventListener("DOMContentLoaded",function(){e(I)},!1),this},get:function(e){return e===w?A.call(this):this[e>=0?e:e+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})},each:function(e){return S.every.call(this,function(t,n){return e.call(t,n,t)!==!1}),this},filter:function(e){return t(e)?this.not(this.not(e)):I(R.call(this,function(t){return W.matches(t,e)}))},add:function(e,t){return I(P(this.concat(I(e,t))))},is:function(e){return this.length>0&&W.matches(this[0],e)},not:function(e){var n=[];if(t(e)&&e.call!==w)this.each(function(t){e.call(this,t)||n.push(this)});else{var r="string"==typeof e?this.filter(e):a(e)&&t(e.item)?A.call(e):I(e);this.forEach(function(e){r.indexOf(e)<0&&n.push(e)})}return I(n)},has:function(e){return this.filter(function(){return i(e)?I.contains(this,e):I(this).find(e).size()})},eq:function(e){return-1===e?this.slice(e):this.slice(e,+e+1)},first:function(){var e=this[0];return e&&!i(e)?e:I(e)},last:function(){var e=this[this.length-1];return e&&!i(e)?e:I(e)},find:function(e){var t,n=this;return t=e?"object"==typeof e?I(e).filter(function(){var e=this;return S.some.call(n,function(t){return I.contains(t,e)})}):1==this.length?I(W.qsa(this[0],e)):this.map(function(){return W.qsa(this,e)}):I()},closest:function(e,t){var n=this[0],i=!1;for("object"==typeof e&&(i=I(e));n&&!(i?i.indexOf(n)>=0:W.matches(n,e));)n=n!==t&&!r(n)&&n.parentNode;return I(n)},parents:function(e){for(var t=[],n=this;n.length>0;)n=I.map(n,function(e){return(e=e.parentNode)&&!r(e)&&t.indexOf(e)<0?(t.push(e),e):void 0});return g(t,e)},parent:function(e){return g(P(this.pluck("parentNode")),e)},children:function(e){return g(this.map(function(){return d(this)}),e)},contents:function(){return this.map(function(){return A.call(this.childNodes)})},siblings:function(e){return g(this.map(function(e,t){return R.call(d(t.parentNode),function(e){return e!==t})}),e)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(e){return I.map(this,function(t){return t[e]})},show:function(){return this.each(function(){"none"==this.style.display&&(this.style.display=""),"none"==getComputedStyle(this,"").getPropertyValue("display")&&(this.style.display=h(this.nodeName))})},replaceWith:function(e){return this.before(e).remove()},wrap:function(e){var n=t(e);if(this[0]&&!n)var r=I(e).get(0),i=r.parentNode||this.length>1;return this.each(function(t){I(this).wrapAll(n?e.call(this,t):i?r.cloneNode(!0):r)})},wrapAll:function(e){if(this[0]){I(this[0]).before(e=I(e));for(var t;(t=e.children()).length;)e=t.first();I(e).append(this)}return this},wrapInner:function(e){var n=t(e);return this.each(function(t){var r=I(this),i=r.contents(),o=n?e.call(this,t):e;i.length?i.wrapAll(o):r.append(o)})},unwrap:function(){return this.parent().each(function(){I(this).replaceWith(I(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(e){return this.each(function(){var t=I(this);(e===w?"none"==t.css("display"):e)?t.show():t.hide()})},prev:function(e){return I(this.pluck("previousElementSibling")).filter(e||"*")},next:function(e){return I(this.pluck("nextElementSibling")).filter(e||"*")},html:function(e){return 0 in arguments?this.each(function(t){var n=this.innerHTML;I(this).empty().append(m(this,e,t,n))}):0 in this?this[0].innerHTML:null},text:function(e){return 0 in arguments?this.each(function(t){var n=m(this,e,t,this.textContent);this.textContent=null==n?"":""+n}):0 in this?this[0].textContent:null},attr:function(e,t){var n;return"string"!=typeof e||1 in arguments?this.each(function(n){if(1===this.nodeType)if(i(e))for(x in e)v(this,x,e[x]);else v(this,e,m(this,t,n,this.getAttribute(e)))}):this.length&&1===this[0].nodeType?!(n=this[0].getAttribute(e))&&e in this[0]?this[0][e]:n:w},removeAttr:function(e){return this.each(function(){1===this.nodeType&&e.split(" ").forEach(function(e){v(this,e)},this)})},prop:function(e,t){return e=X[e]||e,1 in arguments?this.each(function(n){this[e]=m(this,t,n,this[e])}):this[0]&&this[0][e]},data:function(e,t){var n="data-"+e.replace(z,"-$1").toLowerCase(),r=1 in arguments?this.attr(n,t):this.attr(n);return null!==r?b(r):w},val:function(e){return 0 in arguments?this.each(function(t){this.value=m(this,e,t,this.value)}):this[0]&&(this[0].multiple?I(this[0]).find("option").filter(function(){return this.selected}).pluck("value"):this[0].value)},offset:function(e){if(e)return this.each(function(t){var n=I(this),r=m(this,e,t,n.offset()),i=n.offsetParent().offset(),o={top:r.top-i.top,left:r.left-i.left};"static"==n.css("position")&&(o.position="relative"),n.css(o)});if(!this.length)return null;var t=this[0].getBoundingClientRect();return{left:t.left+window.pageXOffset,top:t.top+window.pageYOffset,width:Math.round(t.width),height:Math.round(t.height)}},css:function(t,n){if(arguments.length<2){var r,i=this[0];if(!i)return;if(r=getComputedStyle(i,""),"string"==typeof t)return i.style[T(t)]||r.getPropertyValue(t);if(J(t)){var o={};return I.each(t,function(e,t){o[t]=i.style[T(t)]||r.getPropertyValue(t)}),o}}var a="";if("string"==e(t))n||0===n?a=c(t)+":"+f(t,n):this.each(function(){this.style.removeProperty(c(t))});else for(x in t)t[x]||0===t[x]?a+=c(x)+":"+f(x,t[x])+";":this.each(function(){this.style.removeProperty(c(x))});return this.each(function(){this.style.cssText+=";"+a})},index:function(e){return e?this.indexOf(I(e)[0]):this.parent().children().indexOf(this[0])},hasClass:function(e){return e?S.some.call(this,function(e){return this.test(y(e))},l(e)):!1},addClass:function(e){return e?this.each(function(t){if("className"in this){E=[];var n=y(this),r=m(this,e,t,n);r.split(/\s+/g).forEach(function(e){I(this).hasClass(e)||E.push(e)},this),E.length&&y(this,n+(n?" ":"")+E.join(" "))}}):this},removeClass:function(e){return this.each(function(t){if("className"in this){if(e===w)return y(this,"");E=y(this),m(this,e,t,E).split(/\s+/g).forEach(function(e){E=E.replace(l(e)," ")}),y(this,E.trim())}})},toggleClass:function(e,t){return e?this.each(function(n){var r=I(this),i=m(this,e,n,y(this));i.split(/\s+/g).forEach(function(e){(t===w?!r.hasClass(e):t)?r.addClass(e):r.removeClass(e)})}):this},scrollTop:function(e){if(this.length){var t="scrollTop"in this[0];return e===w?t?this[0].scrollTop:this[0].pageYOffset:this.each(t?function(){this.scrollTop=e}:function(){this.scrollTo(this.scrollX,e)})}},scrollLeft:function(e){if(this.length){var t="scrollLeft"in this[0];return e===w?t?this[0].scrollLeft:this[0].pageXOffset:this.each(t?function(){this.scrollLeft=e}:function(){this.scrollTo(e,this.scrollY)})}},position:function(){if(this.length){var e=this[0],t=this.offsetParent(),n=this.offset(),r=j.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(I(e).css("margin-top"))||0,n.left-=parseFloat(I(e).css("margin-left"))||0,r.top+=parseFloat(I(t[0]).css("border-top-width"))||0,r.left+=parseFloat(I(t[0]).css("border-left-width"))||0,{top:n.top-r.top,left:n.left-r.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||k.body;e&&!j.test(e.nodeName)&&"static"==I(e).css("position");)e=e.offsetParent;return e})}},I.fn.detach=I.fn.remove,["width","height"].forEach(function(e){var t=e.replace(/./,function(e){return e[0].toUpperCase()});I.fn[e]=function(i){var o,a=this[0];return i===w?n(a)?a["inner"+t]:r(a)?a.documentElement["scroll"+t]:(o=this.offset())&&o[e]:this.each(function(t){a=I(this),a.css(e,m(this,i,t,a[e]()))})}}),M.forEach(function(t,n){var r=n%2;I.fn[t]=function(){var t,i,o=I.map(arguments,function(n){return t=e(n),"object"==t||"array"==t||null==n?n:W.fragment(n)}),a=this.length>1;return o.length<1?this:this.each(function(e,t){i=r?t:t.parentNode,t=0==n?t.nextSibling:1==n?t.firstChild:2==n?t:null;var s=I.contains(k.documentElement,i);o.forEach(function(e){if(a)e=e.cloneNode(!0);else if(!i)return I(e).remove();i.insertBefore(e,t),s&&_(e,function(e){null==e.nodeName||"SCRIPT"!==e.nodeName.toUpperCase()||e.type&&"text/javascript"!==e.type||e.src||window.eval.call(window,e.innerHTML)})})})},I.fn[r?t+"To":"insert"+(n?"Before":"After")]=function(e){return I(e)[t](this),this}}),W.Z.prototype=I.fn,W.uniq=P,W.deserializeValue=b,I.zepto=W,I}();window.Zepto=n,void 0===window.$&&(window.$=n),function(e){function t(e){return e._zid||(e._zid=h++)}function n(e,n,o,a){if(n=r(n),n.ns)var s=i(n.ns);return(m[t(e)]||[]).filter(function(e){return!(!e||n.e&&e.e!=n.e||n.ns&&!s.test(e.ns)||o&&t(e.fn)!==t(o)||a&&e.sel!=a)})}function r(e){var t=(""+e).split(".");return{e:t[0],ns:t.slice(1).sort().join(" ")}}function i(e){return new RegExp("(?:^| )"+e.replace(" "," .* ?")+"(?: |$)")}function o(e,t){return e.del&&!y&&e.e in b||!!t}function a(e){return _[e]||y&&b[e]||e}function s(n,i,s,u,l,h,d){var p=t(n),g=m[p]||(m[p]=[]);i.split(/\s/).forEach(function(t){if("ready"==t)return e(document).ready(s);var i=r(t);i.fn=s,i.sel=l,i.e in _&&(s=function(t){var n=t.relatedTarget;return!n||n!==this&&!e.contains(this,n)?i.fn.apply(this,arguments):void 0}),i.del=h;var p=h||s;i.proxy=function(e){if(e=c(e),!e.isImmediatePropagationStopped()){e.data=u;var t=p.apply(n,e._args==f?[e]:[e].concat(e._args));return t===!1&&(e.preventDefault(),e.stopPropagation()),t}},i.i=g.length,g.push(i),"addEventListener"in n&&n.addEventListener(a(i.e),i.proxy,o(i,d))})}function u(e,r,i,s,u){var c=t(e);(r||"").split(/\s/).forEach(function(t){n(e,t,i,s).forEach(function(t){delete m[c][t.i],"removeEventListener"in e&&e.removeEventListener(a(t.e),t.proxy,o(t,u))})})}function c(t,n){return(n||!t.isDefaultPrevented)&&(n||(n=t),e.each(E,function(e,r){var i=n[e];t[e]=function(){return this[r]=w,i&&i.apply(n,arguments)},t[r]=x}),(n.defaultPrevented!==f?n.defaultPrevented:"returnValue"in n?n.returnValue===!1:n.getPreventDefault&&n.getPreventDefault())&&(t.isDefaultPrevented=w)),t}function l(e){var t,n={originalEvent:e};for(t in e)I.test(t)||e[t]===f||(n[t]=e[t]);return c(n,e)}var f,h=1,d=Array.prototype.slice,p=e.isFunction,g=function(e){return"string"==typeof e},m={},v={},y="onfocusin"in window,b={focus:"focusin",blur:"focusout"},_={mouseenter:"mouseover",mouseleave:"mouseout"};v.click=v.mousedown=v.mouseup=v.mousemove="MouseEvents",e.event={add:s,remove:u},e.proxy=function(n,r){var i=2 in arguments&&d.call(arguments,2);if(p(n)){var o=function(){return n.apply(r,i?i.concat(d.call(arguments)):arguments)};return o._zid=t(n),o}if(g(r))return i?(i.unshift(n[r],n),e.proxy.apply(null,i)):e.proxy(n[r],n);throw new TypeError("expected function")},e.fn.bind=function(e,t,n){return this.on(e,t,n)},e.fn.unbind=function(e,t){return this.off(e,t)},e.fn.one=function(e,t,n,r){return this.on(e,t,n,r,1)};var w=function(){return!0},x=function(){return!1},I=/^([A-Z]|returnValue$|layer[XY]$)/,E={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};e.fn.delegate=function(e,t,n){return this.on(t,e,n)},e.fn.undelegate=function(e,t,n){return this.off(t,e,n)},e.fn.live=function(t,n){return e(document.body).delegate(this.selector,t,n),this
},e.fn.die=function(t,n){return e(document.body).undelegate(this.selector,t,n),this},e.fn.on=function(t,n,r,i,o){var a,c,h=this;return t&&!g(t)?(e.each(t,function(e,t){h.on(e,n,r,t,o)}),h):(g(n)||p(i)||i===!1||(i=r,r=n,n=f),(p(r)||r===!1)&&(i=r,r=f),i===!1&&(i=x),h.each(function(f,h){o&&(a=function(e){return u(h,e.type,i),i.apply(this,arguments)}),n&&(c=function(t){var r,o=e(t.target).closest(n,h).get(0);return o&&o!==h?(r=e.extend(l(t),{currentTarget:o,liveFired:h}),(a||i).apply(o,[r].concat(d.call(arguments,1)))):void 0}),s(h,t,i,r,n,c||a)}))},e.fn.off=function(t,n,r){var i=this;return t&&!g(t)?(e.each(t,function(e,t){i.off(e,n,t)}),i):(g(n)||p(r)||r===!1||(r=n,n=f),r===!1&&(r=x),i.each(function(){u(this,t,r,n)}))},e.fn.trigger=function(t,n){return t=g(t)||e.isPlainObject(t)?e.Event(t):c(t),t._args=n,this.each(function(){t.type in b&&"function"==typeof this[t.type]?this[t.type]():"dispatchEvent"in this?this.dispatchEvent(t):e(this).triggerHandler(t,n)})},e.fn.triggerHandler=function(t,r){var i,o;return this.each(function(a,s){i=l(g(t)?e.Event(t):t),i._args=r,i.target=s,e.each(n(s,t.type||t),function(e,t){return o=t.proxy(i),i.isImmediatePropagationStopped()?!1:void 0})}),o},"focusin focusout focus blur load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(t){e.fn[t]=function(e){return 0 in arguments?this.bind(t,e):this.trigger(t)}}),e.Event=function(e,t){g(e)||(t=e,e=t.type);var n=document.createEvent(v[e]||"Events"),r=!0;if(t)for(var i in t)"bubbles"==i?r=!!t[i]:n[i]=t[i];return n.initEvent(e,r,!0),c(n)}}(n),function(e){function t(t,n,r){var i=e.Event(n);return e(t).trigger(i,r),!i.isDefaultPrevented()}function n(e,n,r,i){return e.global?t(n||y,r,i):void 0}function r(t){t.global&&0===e.active++&&n(t,null,"ajaxStart")}function i(t){t.global&&!--e.active&&n(t,null,"ajaxStop")}function o(e,t){var r=t.context;return t.beforeSend.call(r,e,t)===!1||n(t,r,"ajaxBeforeSend",[e,t])===!1?!1:void n(t,r,"ajaxSend",[e,t])}function a(e,t,r,i){var o=r.context,a="success";r.success.call(o,e,a,t),i&&i.resolveWith(o,[e,a,t]),n(r,o,"ajaxSuccess",[t,r,e]),u(a,t,r)}function s(e,t,r,i,o){var a=i.context;i.error.call(a,r,t,e),o&&o.rejectWith(a,[r,t,e]),n(i,a,"ajaxError",[r,i,e||t]),u(t,r,i)}function u(e,t,r){var o=r.context;r.complete.call(o,t,e),n(r,o,"ajaxComplete",[t,r]),i(r)}function c(){}function l(e){return e&&(e=e.split(";",2)[0]),e&&(e==I?"html":e==x?"json":_.test(e)?"script":w.test(e)&&"xml")||"text"}function f(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function h(t){t.processData&&t.data&&"string"!=e.type(t.data)&&(t.data=e.param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=f(t.url,t.data),t.data=void 0)}function d(t,n,r,i){return e.isFunction(n)&&(i=r,r=n,n=void 0),e.isFunction(r)||(i=r,r=void 0),{url:t,data:n,success:r,dataType:i}}function p(t,n,r,i){var o,a=e.isArray(n),s=e.isPlainObject(n);e.each(n,function(n,u){o=e.type(u),i&&(n=r?i:i+"["+(s||"object"==o||"array"==o?n:"")+"]"),!i&&a?t.add(u.name,u.value):"array"==o||!r&&"object"==o?p(t,u,r,n):t.add(n,u)})}var g,m,v=0,y=window.document,b=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,_=/^(?:text|application)\/javascript/i,w=/^(?:text|application)\/xml/i,x="application/json",I="text/html",E=/^\s*$/,T=y.createElement("a");T.href=window.location.href,e.active=0,e.ajaxJSONP=function(t,n){if(!("type"in t))return e.ajax(t);var r,i,u=t.jsonpCallback,c=(e.isFunction(u)?u():u)||"jsonp"+ ++v,l=y.createElement("script"),f=window[c],h=function(t){e(l).triggerHandler("error",t||"abort")},d={abort:h};return n&&n.promise(d),e(l).on("load error",function(o,u){clearTimeout(i),e(l).off().remove(),"error"!=o.type&&r?a(r[0],d,t,n):s(null,u||"error",d,t,n),window[c]=f,r&&e.isFunction(f)&&f(r[0]),f=r=void 0}),o(d,t)===!1?(h("abort"),d):(window[c]=function(){r=arguments},l.src=t.url.replace(/\?(.+)=\?/,"?$1="+c),y.head.appendChild(l),t.timeout>0&&(i=setTimeout(function(){h("timeout")},t.timeout)),d)},e.ajaxSettings={type:"GET",beforeSend:c,success:c,error:c,complete:c,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:x,xml:"application/xml, text/xml",html:I,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},e.ajax=function(t){var n,i=e.extend({},t||{}),u=e.Deferred&&e.Deferred();for(g in e.ajaxSettings)void 0===i[g]&&(i[g]=e.ajaxSettings[g]);r(i),i.crossDomain||(n=y.createElement("a"),n.href=i.url,n.href=n.href,i.crossDomain=T.protocol+"//"+T.host!=n.protocol+"//"+n.host),i.url||(i.url=window.location.toString()),h(i);var d=i.dataType,p=/\?.+=\?/.test(i.url);if(p&&(d="jsonp"),i.cache!==!1&&(t&&t.cache===!0||"script"!=d&&"jsonp"!=d)||(i.url=f(i.url,"_="+Date.now())),"jsonp"==d)return p||(i.url=f(i.url,i.jsonp?i.jsonp+"=?":i.jsonp===!1?"":"callback=?")),e.ajaxJSONP(i,u);var v,b=i.accepts[d],_={},w=function(e,t){_[e.toLowerCase()]=[e,t]},x=/^([\w-]+:)\/\//.test(i.url)?RegExp.$1:window.location.protocol,I=i.xhr(),P=I.setRequestHeader;if(u&&u.promise(I),i.crossDomain||w("X-Requested-With","XMLHttpRequest"),w("Accept",b||"*/*"),(b=i.mimeType||b)&&(b.indexOf(",")>-1&&(b=b.split(",",2)[0]),I.overrideMimeType&&I.overrideMimeType(b)),(i.contentType||i.contentType!==!1&&i.data&&"GET"!=i.type.toUpperCase())&&w("Content-Type",i.contentType||"application/x-www-form-urlencoded"),i.headers)for(m in i.headers)w(m,i.headers[m]);if(I.setRequestHeader=w,I.onreadystatechange=function(){if(4==I.readyState){I.onreadystatechange=c,clearTimeout(v);var t,n=!1;if(I.status>=200&&I.status<300||304==I.status||0==I.status&&"file:"==x){d=d||l(i.mimeType||I.getResponseHeader("content-type")),t=I.responseText;try{"script"==d?(1,eval)(t):"xml"==d?t=I.responseXML:"json"==d&&(t=E.test(t)?null:e.parseJSON(t))}catch(r){n=r}n?s(n,"parsererror",I,i,u):a(t,I,i,u)}else s(I.statusText||null,I.status?"error":"abort",I,i,u)}},o(I,i)===!1)return I.abort(),s(null,"abort",I,i,u),I;if(i.xhrFields)for(m in i.xhrFields)I[m]=i.xhrFields[m];var S="async"in i?i.async:!0;I.open(i.type,i.url,S,i.username,i.password);for(m in _)P.apply(I,_[m]);return i.timeout>0&&(v=setTimeout(function(){I.onreadystatechange=c,I.abort(),s(null,"timeout",I,i,u)},i.timeout)),I.send(i.data?i.data:null),I},e.get=function(){return e.ajax(d.apply(null,arguments))},e.post=function(){var t=d.apply(null,arguments);return t.type="POST",e.ajax(t)},e.getJSON=function(){var t=d.apply(null,arguments);return t.dataType="json",e.ajax(t)},e.fn.load=function(t,n,r){if(!this.length)return this;var i,o=this,a=t.split(/\s/),s=d(t,n,r),u=s.success;return a.length>1&&(s.url=a[0],i=a[1]),s.success=function(t){o.html(i?e("<div>").html(t.replace(b,"")).find(i):t),u&&u.apply(o,arguments)},e.ajax(s),this};var P=encodeURIComponent;e.param=function(t,n){var r=[];return r.add=function(t,n){e.isFunction(n)&&(n=n()),null==n&&(n=""),this.push(P(t)+"="+P(n))},p(r,t,n),r.join("&").replace(/%20/g,"+")}}(n),function(e){e.fn.serializeArray=function(){var t,n,r=[],i=function(e){return e.forEach?e.forEach(i):void r.push({name:t,value:e})};return this[0]&&e.each(this[0].elements,function(r,o){n=o.type,t=o.name,t&&"fieldset"!=o.nodeName.toLowerCase()&&!o.disabled&&"submit"!=n&&"reset"!=n&&"button"!=n&&"file"!=n&&("radio"!=n&&"checkbox"!=n||o.checked)&&i(e(o).val())}),r},e.fn.serialize=function(){var e=[];return this.serializeArray().forEach(function(t){e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(t.value))}),e.join("&")},e.fn.submit=function(t){if(0 in arguments)this.bind("submit",t);else if(this.length){var n=e.Event("submit");this.eq(0).trigger(n),n.isDefaultPrevented()||this.get(0).submit()}return this}}(n),t.exports=n,function(e){"__proto__"in{}||e.extend(e.zepto,{Z:function(t,n){return t=t||[],e.extend(t,e.fn),t.selector=n||"",t.__Z=!0,t},isZ:function(t){return"array"===e.type(t)&&"__Z"in t}});try{getComputedStyle(void 0)}catch(t){var n=getComputedStyle;window.getComputedStyle=function(e){try{return n(e)}catch(t){return null}}}}(n)},{}],12:[function(e,t){t.exports={name:"readium",version:"0.0.1",description:"readium",main:"src/index.js",readme:"README.md",keywords:["readium","hmh"],repository:"TODO",dependencies:{backbone:"^1.1.2","epub-cfi":"^0.0.1",jquery:"^2.1.3",zepto:"file:./lib/zepto","simply-deferred":"^3.0.0",rangy:"^1.3.0-alpha.20140921",underscore:"^1.7.0",URIjs:"^1.14.1"},devDependencies:{browserify:"^8.1.1",envify:"^3.2.0",livereloadify:"^2.0.0","node-static":"^0.7.6","uglify-js":"~2.4.16",watchify:"^2.2.1"},scripts:{build:"NODE_ENV=production browserify src/app.js > ./dist/readium.js && uglifyjs ./dist/readium.js -cm > ./dist/readium.min.js",livereload:"livereloadify ./public",start:"npm run watch & npm run livereload & npm run static","static":"static ./public --port 3000",test:"jest",watch:"watchify -o ./public/readium.js -v -d src/app.js"},author:"Darío Javier Cravero <dario.cravero@hmhco.com>",license:"TBD",browserify:{transform:["envify"]}}},{}],13:[function(e){e("./light-app")},{"./light-app":27}],14:[function(e,t){function n(e,t,n,o){function u(e,t){var n=e.getElementsByTagName("base")[0];if(!n){n=e.createElement("base");var r=e.getElementsByTagName("head")[0];r.insertBefore(n,r.childNodes[0])}n.setAttribute("href",t)}function c(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack)),console.error(e)}function l(e,t,n,i,o,u,c){function l(i){r(e).data("epubZipOrigHref",t),r(e).attr(n,i)}var f=new a(t).absoluteTo(E).toString(),h=S.getResourceURL(f);if(h)l(h);else{var d=r.Deferred();o.push(d),T.relativeToPackageFetchFileContents(f,i,function(t){var n=function(t){if("text"===i){var n=s.identifyContentTypeFromFileName(f),o=r(e).attr("type");o&&(n=o),t=new Blob([t],{type:n})}var a=window.URL.createObjectURL(t);S.putResourceURL(f,a),l(a),d.resolve()};c?c(t,f,n):n(t)},u)}}function f(e,t,n,o,s){var u=e[0],l=e.slice(2),f=i.find(l,function(e){return"undefined"!=typeof e}),d=new a(f),p=""===d.scheme();if(p){var g=new a(f).absoluteTo(n).toString(),m=S.getResourceURL(g);if(m)o[u]={isStyleSheetResource:s,resourceObjectURL:m};else{var v=r.Deferred();t.push(v);var y,b,_=function(e){var t=window.URL.createObjectURL(e);o[u]={isStyleSheetResource:s,resourceObjectURL:t},S.putResourceURL(g,t),v.resolve()},w=function(e){c(e),v.resolve()};s?(y="text",b=function(e){h(e,g,function(e){var t=new Blob([e],{type:"text/css"});_(t)})}):(y="blob",b=_),T.relativeToPackageFetchFileContents(g,y,b,w)}}}function h(e,t,n){var i=/[Uu][Rr][Ll]\(\s*([']([^']+)[']|["]([^"]+)["]|([^)]+))\s*\)/g,o=/@[Ii][Mm][Pp][Oo][Rr][Tt]\s*('([^']+)'|"([^"]+)")/g,a={},s=[];[o,i].forEach(function(n){for(var r=n.exec(e);null!=r;){var i=!1;n==o&&(i=!0),f(r,s,t,a,i),r=n.exec(e)}}),s.length>0?r.when.apply(r,s).done(function(){for(var t in a){var r,i=a[t];r=i.isStyleSheetResource?'@import "'+i.resourceObjectURL+'"':"url('"+i.resourceObjectURL+"')";var o=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),s=new RegExp(o,"g");e=e.replace(s,r,"g")}n(e)}):n(e)}function d(e,t,n,i,o,s){var u=r(e+"["+t+"]",x);u.each(function(e,u){var c=r(u).attr(t),f=new a(c);""===f.scheme()&&l(u,c,t,n,i,o,s)})}function p(e,t){d("img","src","blob",e,t)}function g(e,t){d("audio","src","blob",e,t)}function m(e,t){d("video","src","blob",e,t),d("video","poster","blob",e,t)}function v(e,t){d("script","src","blob",e,t)}function y(e,t){d("iframe","src","blob",e,t)}function b(e,t){d("link","href","text",e,t,h)}function _(e){var t=r("style",x);t.each(function(t,n){var i=r.Deferred();e.push(i);var o=r(n).text();h(o,E,function(e){r(n).text(e),i.resolve()})})}var w,x,I=this,E=t.href,T=e,P=t.media_type,S=o;this.fetchContentDocumentAndResolveDom=function(e,t){T.relativeToPackageFetchFileContents(E,"text",function(n){w=n,I.resolveInternalPackageResources(e,t)},t)},this.resolveInternalPackageResources=function(e,t){x=T.markupParser.parseMarkup(w,P),u(x,n);var i=[];T.shouldFetchMediaAssetsProgrammatically()&&(p(i,t),g(i,t),m(i,t)),y(i,t),v(i,t),b(i,t),_(i,t),r.when.apply(r,i).done(function(){e(x)})}}var r=e("zepto"),i=e("underscore"),o=e("simply-deferred"),a=e("URIjs"),s=e("./discover-content-type");o.installTo(r),t.exports=n},{"./discover-content-type":15,URIjs:5,"simply-deferred":9,underscore:10,zepto:11}],15:[function(e,t){function n(){var e=this;n.suffixContentTypeMap={css:"text/css",epub:"application/epub+zip",gif:"image/gif",html:"text/html",jpg:"image/jpeg",jpeg:"image/jpeg",ncx:"application/x-dtbncx+xml",opf:"application/oebps-package+xml",png:"image/png",svg:"image/svg+xml",xhtml:"application/xhtml+xml"},this.identifyContentTypeFromFileName=function(e){var t=i(e).suffix(),r="application/octet-stream";return"undefined"!=typeof n.suffixContentTypeMap[t]&&(r=n.suffixContentTypeMap[t]),r},this.identifyContentType=function(t){var n=r.ajax({type:"HEAD",url:t,async:!1}).getResponseHeader("Content-Type");return null===n&&(n=e.identifyContentTypeFromFileName(t),console.log("guessed contentType ["+n+"] from URI ["+t+"]. Configuring the web server to provide the content type is recommended.")),n}}var r=e("zepto"),i=(e("underscore"),e("backbone"),e("URIjs")),o=void 0;o||(o=new n),t.exports=o},{URIjs:5,backbone:7,underscore:10,zepto:11}],16:[function(e,t){function n(e){function t(e,t){var n=new FileReader;n.onload=function(){var e=this.result;t(new Uint8Array(e))},n.readAsArrayBuffer(e)}function n(e,n,r,i){var o=e.slice(0,n);t(o,function(t){for(var o=r.length,a=0;n>a;a++)t[a]=t[a]^r[a%o];var s=new Blob([t],{type:e.type}),u=e.slice(n),c=new Blob([s,u],{type:e.type});i(c)})}function r(t,r){var i=1040;n(t,i,e.uidHash,r)}function i(e){var t=/(urn:uuid:)?([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/i,n=t.exec(e),r=n[2]+n[3]+n[4]+n[5]+n[6];r&&32==r.length||console.error("Bad UUID format for ID :"+e);for(var i=[],o=0;16>o;o++){var a=r.substr(2*o,2),s=parseInt(a,16);i.push(s)}return i}function o(t,r){var o=i(e.uid),a=1024;n(t,a,o,r)}var a=this,s={"http://www.idpf.org/2008/embedding":r,"http://ns.adobe.com/pdf/enc#RC":o};this.isEncryptionSpecified=function(){return e&&e.encryptions},this.getEncryptionMethodForRelativePath=function(t){return a.isEncryptionSpecified()?e.encryptions[t]:void 0},this.getDecryptionFunctionForRelativePath=function(e){var t=a.getEncryptionMethodForRelativePath(e);return t&&s[t]?s[t]:void 0}}var r=e("zepto");n.CreateEncryptionData=function(e,t){var n={uid:e,uidHash:window.Crypto.SHA1(unescape(encodeURIComponent(e.trim())),{asBytes:!0}),encryptions:void 0},i=r("EncryptedData",t);return i.each(function(e,t){var i=r("EncryptionMethod",t).first().attr("Algorithm"),o=r("CipherReference",t);o.each(function(e,t){var o=r(t).attr("URI");console.log("Encryption/obfuscation algorithm "+i+" specified for "+o),n.encryptions||(n.encryptions={}),n.encryptions[o]=i})}),n},t.exports=n},{zepto:11}],17:[function(e,t){function n(){var e=this;this.parseXml=function(t){return e.parseMarkup(t,"text/xml")},this.parseMarkup=function(e,t){var n=new window.DOMParser;return n.parseFromString(e,t)}}t.exports=n},{}],18:[function(e,t){function n(e,t){function n(e,t,n){var r=s.resolveURI(e);if("undefined"==typeof e)throw"Fetched file relative path is undefined!";var i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType="arraybuffer",i.onerror=n,i.onload=function(){t(i.response)},i.send()}var o,a,s=this;this.initialize=function(n){e.getXmlFileDom("META-INF/container.xml",function(t){a=e.getRootFile(t),o=s.resolveURI(a),n()},function(e){console.error("unable to find package document: "+e),o=t,n()})},this.resolveURI=function(e){return t+"/"+e},this.getPackageUrl=function(){return o},this.fetchFileContentsText=function(e,t,n){var i=s.resolveURI(e);if("undefined"==typeof i)throw"Fetched file URL is undefined!";r.ajax({isLocal:0===i.indexOf("http")?!1:!0,url:i,dataType:"text",async:!0,success:function(e){t(e)},error:function(e,t,r){console.error("Error when AJAX fetching "+i),console.error(t),console.error(r),n(r)}})},this.fetchFileContentsBlob=function(t,r,o){var a=e.getDecryptionFunctionForRelativePath(t);if(a){var s=r;r=function(e){a(e,function(e){s(e)})}}n(t,function(e){var n=new Blob([e],{type:i.identifyContentTypeFromFileName(t)});r(n)},o)},this.getPackageDom=function(t,n){s.fetchFileContentsText(a,function(n){var r=e.markupParser.parseXml(n);t(r)},n)}}var r=e("zepto"),i=(e("underscore"),e("URIjs"),e("./discover-content-type"));t.exports=n},{"./discover-content-type":15,URIjs:5,underscore:10,zepto:11}],19:[function(e,t){function n(e,t){function n(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack)),console.error(e)}function o(){var t=".epub";return-1===e.indexOf(t,e.length-t.length)}function h(n,r){return n?(console.log("using new PlainResourceFetcher"),g=new u(d,e),void g.initialize(function(){r(g)})):(console.log("using new ZipResourceFetcher"),g=new f(d,e,t),r(g),void 0)}var d=this;d.contentTypePackageReadStrategyMap={"application/oebps-package+xml":"exploded","application/epub+zip":"zipped","application/zip":"zipped"};var p,g,m,v,y,b,_=new c;this.markupParser=new s,this.initialize=function(e){var t=o();p=!t,h(t,e)},this.shouldConstructDomProgrammatically=function(){return p},this.shouldFetchMediaAssetsProgrammatically=function(){return p&&!o()},this.getBookRoot=function(){return e},this.getJsLibRoot=function(){return t},this.getPackageUrl=function(){return g.getPackageUrl()},this.fetchContentDocument=function(e,t,r,o){var a=new i(d,e.spineItem,t,_);a.fetchContentDocumentAndResolveDom(r,function(e){n(e),o(e)})},this.getFileContentsFromPackage=function(e,t,n){g.fetchFileContentsText(e,function(e){t(e)},n)},this.getXmlFileDom=function(e,t,n){d.getFileContentsFromPackage(e,function(e){var n=d.markupParser.parseXml(e);t(n)},n)},this.getPackageFullPath=function(e,t){d.getXmlFileDom("META-INF/container.xml",function(t){var n=d.getRootFile(t);e(n)},t)},this.getRootFile=function(e){var t=r("rootfile",e),n=t.attr("full-path");return n},this.getPackageDom=function(e,t){y?e(y):b?b.done(e):(b=r.Deferred(),b.done(e),d.getPackageFullPath(function(e){v=e,d.getXmlFileDom(e,function(e){y=e,b.resolve(e),b=void 0})},t))},this.convertPathRelativeToPackageToRelativeToBase=function(e){return new l(e).absoluteTo(v).toString()},this.relativeToPackageFetchFileContents=function(e,t,r,i){i||(i=n);var o=decodeURIComponent(d.convertPathRelativeToPackageToRelativeToBase(e));"/"===o.charAt(0)&&(o=o.substr(1));var a=g.fetchFileContentsText;"blob"===t?a=g.fetchFileContentsBlob:"data64uri"===t&&(a=g.fetchFileContentsData64Uri),a.call(g,o,r,i)},this.getRelativeXmlFileDom=function(e,t,n){d.getXmlFileDom(d.convertPathRelativeToPackageToRelativeToBase(e),t,n)},this.setPackageMetadata=function(e,t){d.getXmlFileDom("META-INF/encryption.xml",function(n){var r=a.CreateEncryptionData(e.id,n);m=new a(r),m.isEncryptionSpecified()&&(p=!0),t()},function(){console.log("Document doesn't make use of encryption."),m=new a(void 0),t()})},this.getDecryptionFunctionForRelativePath=function(e){return m.getDecryptionFunctionForRelativePath(e)}}var r=e("zepto"),i=e("./content-document-fetcher"),o=e("simply-deferred"),a=e("./encryption-handler"),s=e("./markup-parser"),u=e("./plain-resource-fetcher"),c=e("./resource-cache"),l=e("URIjs"),f=e("./zip-resource-fetcher");o.installTo(r),t.exports=n},{"./content-document-fetcher":14,"./encryption-handler":16,"./markup-parser":17,"./plain-resource-fetcher":18,"./resource-cache":20,"./zip-resource-fetcher":21,URIjs:5,"simply-deferred":9,zepto:11}],20:[function(e,t){function n(){var e={};this.getResourceURL=function(t){var n=e[t];return n},this.putResourceURL=function(t,n){e[t]=n}}t.exports=n},{}],21:[function(e,t){function n(e,t,n){function i(e,r){a?e(a,r):(zip.workerScriptsPath=n,a=new zip.fs.FS,a.importHttpContent(t,!0,function(){e(a,r)},r))}function o(e,n,r){if("undefined"==typeof e)throw"Fetched file relative path is undefined!";i(function(r,i){var o=r.find(e);"undefined"==typeof o||null===o?i(new Error("Entry "+e+" not found in zip "+t)):o.directory?i(new Error("Entry "+e+" is a directory while a file has been expected")):n(o)},r)}var a,s=!1;this.getPackageUrl=function(){return t},this.fetchFileContentsText=function(e,t,n){o(e,function(e){e.getText(t,void 0,s)},n)},this.fetchFileContentsData64Uri=function(e,t,n){o(e,function(n){n.getData64URI(r.identifyContentTypeFromFileName(e),t,void 0,s)},n)},this.fetchFileContentsBlob=function(t,n,i){var a=e.getDecryptionFunctionForRelativePath(t);if(a){var u=n;n=function(e){a(e,function(e){u(e)})}}o(t,function(e){e.getBlob(r.identifyContentTypeFromFileName(t),n,void 0,s)},i)}}var r=(e("zepto"),e("underscore"),e("URIjs"),e("./discover-content-type"));t.exports=n},{"./discover-content-type":15,URIjs:5,underscore:10,zepto:11}],22:[function(e,t){function n(e){var t,n={};this.manifestLength=function(){return e.length},this.getManifestItemByIdref=function(e){return n[e]},this.each=function(t){return r.each(e,t),this},this.getNavItem=function(){return t},this.each(function(e){n[e.id]=e,e.properties&&-1!==e.properties.indexOf("nav")&&(t=e)})}var r=e("underscore");t.exports=n},{underscore:10}],23:[function(e,t){function n(){var e=this,t={};this.eachMediaItem=function(t){return e.mediaItems&&r.each(e.mediaItems,t),this},this.getMediaItemByRefinesId=function(e){return t[e]},this.setMoMap=function(t){e.media_overlay.smil_models=t},this.eachMediaItem(function(e){var n=e.refines,r=n.indexOf("#");if(r>=0){var i=r+1,o=n.length-1;n=n.substr(i,o)}n=n.trim(),t[n]=e})}var r=e("underscore");t.exports=n},{underscore:10}],24:[function(e,t){function n(e,t){function n(e){e&&(e.message&&console.error(e.message),e.stack&&console.error(e.stack))}function o(e,n){var r=new l(e,t);r.fillSmilData(function(){n(e)})}function f(e){var n=r.Deferred();if(e.rendition_layout)n.resolve();else{var i="/META-INF/com.apple.ibooks.display-options.xml";t.relativeToPackageFetchFileContents(i,"text",function(t){if(t){var i=new s,o=i.parseXml(t),a=r("option[name=fixed-layout]",o)[0];if(a){var u=r(a).text();"true"===u&&(e.rendition_layout="pre-paginated",console.log("using com.apple.ibooks.display-options.xml fixed-layout property"))}}n.resolve()},function(){console.log("com.apple.ibooks.display-options.xml not found"),n.resolve()})}return n.promise()}function h(e,t,n){var o,a=[];return o=r(d(e,"spine")).children(),r.each(o,function(e,o){var s=r(o),u=s.attr("idref")?s.attr("idref"):"",c=t.getManifestItemByIdref(u),l=s.attr("id"),f=void 0;i.each(n.rendition_viewports,function(e){return e.refines==l?(f=e.viewport,!0):void 0});var h={rendition_viewport:f,idref:u,href:c.href,manifest_id:c.id,media_type:c.media_type,media_overlay_id:c.media_overlay_id,linear:s.attr("linear")?s.attr("linear"):"",properties:s.attr("properties")?s.attr("properties"):""},d=x(h.properties);i.extend(h,d),a.push(h)}),a}function d(e,t,n){var r=e.getElementsByTagNameNS("*",t);return n?i.find(r,n):r[0]}function p(e,t,n){var r=e.getElementsByTagNameNS("*",t);return i.filter(r,n)}function g(e,t,n){var r=d(e,t,n);return r?r.textContent:""}function m(e,t,n,r){var i=d(e,t,r);return i?i.getAttribute(n):""}function v(e,t){var n=d(e,"meta",function(e){return e.getAttribute("property")===t});return n?n.textContent:""}function y(e){var t=new u,n=d(e,"metadata"),r=d(e,"package"),o=d(e,"spine");t.author=g(n,"creator"),t.description=g(n,"description"),t.epub_version=r.getAttribute("version")?r.getAttribute("version"):"",t.id=g(n,"identifier"),t.language=g(n,"language"),t.modified_date=v(n,"dcterms:modified"),t.ncx=o.getAttribute("toc")?o.getAttribute("toc"):"",t.pubdate=g(n,"date"),t.publisher=g(n,"publisher"),t.rights=g(n,"rights"),t.title=g(n,"title"),t.rendition_orientation=v(n,"rendition:orientation"),t.rendition_layout=v(n,"rendition:layout"),t.rendition_spread=v(n,"rendition:spread"),t.rendition_flow=v(n,"rendition:flow"),t.rendition_viewport=g(n,"meta",function(e){return"rendition:viewport"===e.getAttribute("property")&&!e.hasAttribute("refines")});var a=[],s=p(n,"meta",function(e){return"rendition:viewport"===e.getAttribute("property")&&e.hasAttribute("refines")});i.each(s,function(e){var t=e.getAttribute("refines");if(t){var n=t.indexOf("#");if(n>=0){var r=n+1,i=t.length-1;t=t.substr(r,i)}t=t.trim()}var o={refines:t,viewport:e.textContent};a.push(o)}),t.rendition_viewports=a,t.mediaItems=[];var c=p(n,"meta",function(e){return"media:duration"===e.getAttribute("property")&&e.hasAttribute("refines")});return i.each(c,function(e){t.mediaItems.push({refines:e.getAttribute("refines"),duration:l.resolveClockValue(e.textContent)})}),t.media_overlay={duration:l.resolveClockValue(g(n,"meta",function(e){return"media:duration"===e.getAttribute("property")&&!e.hasAttribute("refines")})),narrator:v(n,"media:narrator"),activeClass:v(n,"media:active-class"),playbackActiveClass:v(n,"media:playback-active-class"),smil_models:[],skippables:["sidebar","practice","marginalia","annotation","help","note","footnote","rearnote","table","table-row","table-cell","list","list-item","pagebreak"],escapables:["sidebar","bibliography","toc","loi","appendix","landmarks","lot","index","colophon","epigraph","conclusion","afterword","warning","epilogue","foreword","introduction","prologue","preface","preamble","notice","errata","copyright-page","acknowledgments","other-credits","titlepage","imprimatur","contributors","halftitlepage","dedication","help","annotation","marginalia","practice","note","footnote","rearnote","footnotes","rearnotes","bridgehead","page-list","table","table-row","table-cell","list","list-item","glossary"]},t}function b(e){var t=r(d(e,"manifest")).children(),n=[];return r.each(t,function(e,t){var i=r(t),o=i.attr("href")?i.attr("href"):"",a={href:o,id:i.attr("id")?i.attr("id"):"",media_overlay_id:i.attr("media-overlay")?i.attr("media-overlay"):"",media_type:i.attr("media-type")?i.attr("media-type"):"",properties:i.attr("properties")?i.attr("properties"):""};n.push(a)}),n}function _(e){var t=r(d(e,"bindings")).children(),n=[];return r.each(t,function(e,t){var i=r(t),o={handler:i.attr("handler")?i.attr("handler"):"",media_type:i.attr("media-type")?i.attr("media-type"):""};n.push(o)}),n}function w(e){var t,n;if(t=d(e,"manifest"),n=r(d(t,"item",function(e){var t=e.getAttribute("properties");return t&&i.contains(t.split(" "),"cover-image")})),1===n.length&&n.attr("href"))return n.attr("href");var o=r(d(e,"meta",function(e){return"cover"===e.getAttribute("name")})),a=o.attr("content");return 1===o.length&&a&&(n=r(d(t,"item",function(e){return e.getAttribute("id")===a})),1===n.length&&n.attr("href"))?n.attr("href"):(n=r(d(t,"item",function(e){return"cover"===e.getAttribute("id")})),1===n.length&&n.attr("href")?n.attr("href"):null)}function x(e){for(var t={},n=e.split(" "),r=0;r<n.length;r++)"rendition:orientation-landscape"===n[r]&&(t.rendition_orientation="landscape"),"rendition:orientation-portrait"===n[r]&&(t.rendition_orientation="portrait"),"rendition:orientation-auto"===n[r]&&(t.rendition_orientation="auto"),"rendition:spread-none"===n[r]&&(t.rendition_spread="none"),"rendition:spread-landscape"===n[r]&&(t.rendition_spread="landscape"),"rendition:spread-portrait"===n[r]&&(t.rendition_spread="portrait"),"rendition:spread-both"===n[r]&&(t.rendition_spread="both"),"rendition:spread-auto"===n[r]&&(t.rendition_spread="auto"),"rendition:flow-paginated"===n[r]&&(t.rendition_flow="paginated"),"rendition:flow-scrolled-continuous"===n[r]&&(t.rendition_flow="scrolled-continuous"),"rendition:flow-scrolled-doc"===n[r]&&(t.rendition_flow="scrolled-doc"),"rendition:flow-auto"===n[r]&&(t.rendition_flow="auto"),"rendition:page-spread-center"===n[r]&&(t.page_spread="page-spread-center"),"page-spread-left"===n[r]&&(t.page_spread="page-spread-left"),"page-spread-right"===n[r]&&(t.page_spread="page-spread-right"),"rendition:layout-reflowable"===n[r]&&(t.fixed_flow=!1,t.rendition_layout="reflowable"),"rendition:layout-pre-paginated"===n[r]&&(t.fixed_flow=!0,t.rendition_layout="pre-paginated");return t}var I,E=t,T=r.Deferred();t.getPackageDom(function(e){I=e,T.resolve(e)},n),this.parse=function(e){T.done(function(n){var i=y(n),s=(n.getElementsByTagNameNS("*","spine")[0],m(n,"spine","page-progression-direction")),u=(_(n),new a(b(n))),l=h(n,u,i),d=w(n);d&&(i.cover_href=d),r.when(f(i)).then(function(){E.setPackageMetadata(i,function(){var n=new c(t.getPackageUrl(),t,i,l,u);n.setPageProgressionDirection(s),o(n,e)})})})}}var r=e("zepto"),i=e("underscore"),o=(e("backbone"),e("simply-deferred")),a=e("./manifest"),s=e("../epub-fetch/markup-parser"),u=e("./metadata"),c=(e("URIjs"),e("./package-document")),l=e("./smil-document-parser");o.installInto(r),t.exports=n},{"../epub-fetch/markup-parser":17,"./manifest":22,"./metadata":23,"./package-document":25,"./smil-document-parser":26,URIjs:5,backbone:7,"simply-deferred":9,underscore:10,zepto:11}],25:[function(e,t){function n(e,t,n,o,a){function s(){var e=l(),t=e.href,n=t.substr(t.lastIndexOf(".")+1);return"ncx"===n.trim().toLowerCase()}function u(e){var t=r("<ol></ol>");return r.each(e.children("navPoint"),function(e,n){c(r(n),t)}),t}function c(e,t){var n=e.children("navLabel").text().trim(),i=e.children("content").attr("src"),o=r('<li class="nav-elem"></li>').append(r("<a></a>",{href:i,text:n}));if(t.append(o),e.children("navPoint").length>0){var a=r("<li></li>"),s=r("<ol></ol>");r.each(e.children("navPoint"),function(e,t){s.append(c(r(t),s))}),a.append(s),t.append(a)}}function l(){var e=a.getNavItem();if(e)return e;var t=n.ncx;return t&&t.length>0?a.getManifestItemByIdref(t):null}var f;this.manifest=a,this.getSharedJsPackageData=function(){var t=e.substr(0,e.lastIndexOf("/"));return{rootUrl:t,rendition_viewport:n.rendition_viewport,rendition_layout:n.rendition_layout,rendition_orientation:n.rendition_orientation,rendition_flow:n.rendition_flow,rendition_spread:n.rendition_spread,media_overlay:n.media_overlay,spine:{direction:this.getPageProgressionDirection(),items:o}}},this.getSpineItem=function(e){var t=o[e];return t},this.setPageProgressionDirection=function(e){f=e},this.getPageProgressionDirection=function(){return"rtl"===f?"rtl":"default"===f?"default":"ltr"},this.spineLength=function(){return o.length},this.getMetadata=function(){return n},this.getToc=function(){var e=l();return e?e.href:null},this.getTocText=function(e){var n=this.getToc();t.relativeToPackageFetchFileContents(n,"text",function(t){e(t)},function(t){console.error("ERROR fetching TOC from ["+n+"]:"),console.error(t),e(void 0)})},this.getTocDom=function(e){this.getTocText(function(t){if("string"==typeof t){var n=(new DOMParser).parseFromString(t,"text/xml");e(n)}else e(void 0)})},this.generateTocListDOM=function(t){var n=this;this.getTocDom(function(o){if(o)if(s()){var a;a=u(r("navMap",o)),t(a[0])}else{var c=new i(e).absoluteTo(document.URL),l=new i(n.getToc()).absoluteTo(c),f=(r(o).remove("base"),r("<base></base>"));r(f).attr("href",l),r(o).find("head").append(f),t(o)}else t(void 0)})}}var r=e("zepto"),i=(e("underscore"),e("backbone"),e("URIjs"));t.exports=n},{URIjs:5,backbone:7,underscore:10,zepto:11}],26:[function(e,t){function n(e,t){function i(e){return{id:"",href:"",spineItemId:e.idref,children:[{nodeType:"seq",textref:e.href,children:[{nodeType:"par",children:[{nodeType:"text",src:e.href,srcFile:e.href,srcFragmentId:""}]}]}]}}this.parse=function(n,i,o,a,s,u){var c=this;t.getRelativeXmlFileDom(i.href,function(t){var u=r("smil",t)[0];o.smilVersion=u.getAttribute("version"),o.children=c.getChildren(u),o.href=i.href,o.id=i.id,o.spineItemId=n.idref;var l=e.getMetadata().getMediaItemByRefinesId(i.id);l&&(o.duration=l.duration),s(a,o)},function(e){u(a,e)})};var o=function(e,t,n,r,i){var o=e.split(":"),a=o[o.length-1];"type"===a&&(a="epubtype"),void 0!=t.getAttribute(e)?n[a]=t.getAttribute(e):r&&(void 0!==i?n[a]=i:console.log("Required property "+e+" not found in smil node "+t.nodeName))};this.getChildren=function(e){var t=this,n=[];return r.each(e.childNodes,function(e,r){if(1===r.nodeType){var i=t.createItemFromElement(r);i&&n.push(i)}}),n},this.createItemFromElement=function(e){var t=this,r={};
r.nodeType=e.nodeName;var i=!1;if("body"===r.nodeType&&(i=!0,r.nodeType="seq"),"seq"===r.nodeType)o("epub:textref",e,r,!i),o("id",e,r),o("epub:type",e,r),r.children=t.getChildren(e);else if("par"===r.nodeType)o("id",e,r),o("epub:type",e,r),r.children=t.getChildren(e);else if("text"===r.nodeType){o("src",e,r,!0);var a=r.src.split("#");r.srcFile=a[0],r.srcFragmentId=2===a.length?a[1]:"",o("id",e,r)}else{if("audio"!==r.nodeType)return void 0;o("src",e,r,!0),o("id",e,r),r.clipBegin=n.resolveClockValue(e.getAttribute("clipBegin")),r.clipEnd=n.resolveClockValue(e.getAttribute("clipEnd"))}return r},this.fillSmilData=function(t){var n=this;if(e.spineLength()<=0)return void t();for(var o=!0,a=[],s=[],u=0;u<e.spineLength();u++){var c=e.getSpineItem(u);if(c.media_overlay_id){var l=e.manifest.getManifestItemByIdref(c.media_overlay_id);if(!l){console.error("Cannot find SMIL manifest item for spine/manifest item?! "+c.media_overlay_id);continue}var f=r.Deferred();f.media_overlay_id=c.media_overlay_id,s.push(f);var h={};a.push(h),n.parse(c,l,h,f,function(e){o=!1,e.resolve()},function(e,t){console.log("Error when parsing SMIL manifest item "+l.href+":"),console.log(t),e.resolve()})}else a.push(i(c))}r.when.apply(r,s).done(function(){e.getMetadata().setMoMap(a),o&&(console.log("No Media Overlays"),e.getMetadata().setMoMap([])),t()})}}var r=e("zepto"),i=(e("underscore"),e("simply-deferred"));i.installTo(r),n.resolveClockValue=function(e){if(!e)return 0;var t=0,n=0,r=0;if(-1!=e.indexOf("min"))n=parseFloat(e.substr(0,e.indexOf("min")));else if(-1!=e.indexOf("ms")){var i=parseFloat(e.substr(0,e.indexOf("ms")));r=i/1e3}else if(-1!=e.indexOf("s"))r=parseFloat(e.substr(0,e.indexOf("s")));else if(-1!=e.indexOf("h"))t=parseFloat(e.substr(0,e.indexOf("h")));else{var o=e.split(":");r=parseFloat(o.pop()),o.length>0&&(n=parseFloat(o.pop()),o.length>0&&(t=parseFloat(o.pop())))}var a=3600*t+60*n+r;return a},t.exports=n},{"simply-deferred":9,underscore:10,zepto:11}],27:[function(e){(function(t){var n=new(e("./light-reader"))({useSimpleLoader:!0},{el:"#readium-container"}),r=e("URIjs"),i=new(e("../lib/epubjs/parser"));n.openPackageDocument("demo-book",function(e,o){e.getTocDom(function(e){var t=document.getElementById("toc");console.log("toc",i.nav(e,{},{})),t.innerHTML=e.documentElement.querySelector("body").innerHTML,t.addEventListener("click",function(e){if("A"===e.target.tagName){e.preventDefault();var t=r(e.target.href).path().replace(/^\//,"");n.reader.openContentUrl(t)}},!0)}),document.getElementById("left-page").addEventListener("click",function(){n.reader.openPageLeft()},!1),document.getElementById("right-page").addEventListener("click",function(){n.reader.openPageRight()},!1),"production"!==t.env.node_env&&(window.readiumPackageDocument=e,window.readiumOptions=o)}),"production"!==t.env.node_env&&(window.readiumReader=n)}).call(this,e("_process"))},{"../lib/epubjs/parser":1,"./light-reader":28,URIjs:5,_process:8}],28:[function(e,t){function n(e,t){var n,s=this,u=e.jsLibRoot;t.iframeLoader=new i.Views.IFrameLoader,this.reader=new i.Views.ReaderView(t),this.openPackageDocument=function(t,i,c){n=new a(t,u),n.initialize(function(){var a=new o(t,n);a.parse(function(t){var o=e.openBookOptions||{},a=r.extend(t.getSharedJsPackageData(),o);c&&(a.openPageRequest=c),s.reader.openBook(a);var u={packageDocumentUrl:n.getPackageUrl(),metadata:t.getMetadata()};i&&i(t,u)})})},i.reader=this.reader,i.trigger(i.Events.READER_INITIALIZED,this.reader)}var r=e("zepto"),i=e("./light-sdk"),o=e("./epub/package-document-parser"),a=e("./epub-fetch/publication-fetcher");if(window&&"URL"in window==!1){if("webkitURL"in window==!1)throw Error("Browser does not support window.URL");window.URL=window.webkitURL}n.version=e("../package.json").version,t.exports=n},{"../package.json":12,"./epub-fetch/publication-fetcher":19,"./epub/package-document-parser":24,"./light-sdk":50,zepto:11}],29:[function(e,t){function n(){var e=[];this.clear=function(){e.length=0},this.findStyle=function(t){for(var n=e.length,r=0;n>r;r++)if(e[r].selector===t)return e[r];return void 0},this.addStyle=function(t,n){var i=this.findStyle(t);return i?i.setDeclarations(n):(i=new r(t,n),e.push(i)),i},this.removeStyle=function(t){for(var n=e.length,r=0;n>r;r++)if(e[r].selector===t)return void e.splice(r,1)},this.getStyles=function(){return e},this.resetStyleValues=function(){for(var t=e.length,n=0;t>n;n++){var r=e[n],i=r.declarations;for(var o in i)i.hasOwnProperty(o)&&(i[o]="")}}}var r=e("../models/style");t.exports=n},{"../models/style":60}],30:[function(e,t){t.exports={READER_INITIALIZED:"ReaderInitialized",PAGINATION_CHANGED:"PaginationChanged",SETTINGS_APPLIED:"SettingsApplied",FXL_VIEW_RESIZED:"FXLViewResized",READER_VIEW_CREATED:"ReaderViewCreated",READER_VIEW_DESTROYED:"ReaderViewDestroyed",CONTENT_DOCUMENT_LOAD_START:"ContentDocumentLoadStart",CONTENT_DOCUMENT_LOADED:"ContentDocumentLoaded",MEDIA_OVERLAY_STATUS_CHANGED:"MediaOverlayStatusChanged",MEDIA_OVERLAY_TTS_SPEAK:"MediaOverlayTTSSpeak",MEDIA_OVERLAY_TTS_STOP:"MediaOverlayTTSStop"}},{}],31:[function(e,t){function n(e,t){return 0===e.indexOf(t)}t.exports=n},{}],32:[function(e,t){function n(e){var t,n,r,i=e.enable3D?!0:!1,o=e.origin;if(e.left||e.top){var a=e.left||0,s=e.top||0;t=i?"translate3D("+a+"px, "+s+"px, 0)":"translate("+a+"px, "+s+"px)"}if(e.scale&&(n=i?"scale3D("+e.scale+", "+e.scale+", 0)":"scale("+e.scale+")"),e.angle&&(r=i?"rotate3D(0,0,"+e.angle+"deg)":"rotate("+e.angle+"deg)"),!(t||n||r))return{};var u=t&&n?t+" "+n:t?t:n;r&&(u=u+" "+r);var c={};return c.transform=u,c["transform-origin"]=o?o:i?"0 0 0":"0 0",c}t.exports=n},{}],33:[function(e,t){function n(e,t){var n={};r.each(["","-webkit-","-moz-","-ms-"],function(e){n[e+"transition"]=e+t}),e.css(n)}var r=e("underscore");t.exports=n},{underscore:10}],34:[function(e,t){function n(e,t,n){if(!e||0==e.length)return 0;var a=t?t.getRenditionSpread():void 0;if(a===i.RENDITION_SPREAD_NONE)return!1;if("double"==n.syntheticSpread)return!0;if("single"==n.syntheticSpread)return!1;if(!t)return 0;if(a===i.RENDITION_SPREAD_BOTH)return!0;var s=r(e);if(a===i.RENDITION_SPREAD_LANDSCAPE)return s===o.ORIENTATION_LANDSCAPE;if(a===i.RENDITION_SPREAD_PORTRAIT)return s===o.ORIENTATION_PORTRAIT;if(!a||a===i.RENDITION_SPREAD_AUTO){var u=s===o.ORIENTATION_LANDSCAPE;return u?1:0}return console.warn("Helpers.deduceSyntheticSpread: spread properties?!"),0}var r=e("./get-orientation"),i=e("../models/spine-item-constants"),o=e("../views/constants");t.exports=n},{"../models/spine-item-constants":57,"../views/constants":66,"./get-orientation":38}],35:[function(e,t){function n(e,t){return-1!==e.indexOf(t,e.length-t.length)}t.exports=n},{}],36:[function(e,t){function n(e){if(!e)return void 0;var t=e.replace(/([;&,\.\+\*\~\?':"\!\^#$%@\[\]\(\)<=>\|\/\\{}`])/g,"\\$1");return t}t.exports=n},{}],37:[function(e,t){function n(e,t,n,r,i,o){r||(r=250),i||(i=r);var a,s,u=!0;return function(){var c=o||this,l=Date.now&&Date.now()||(new Date).getTime(),f=arguments;a&&a+r>l||(a=l,u?(e.apply(c,f),u=!1):t.apply(c,f)),clearTimeout(s),s=setTimeout(function(){a=l,u=!0,n.apply(c,f)},i)}}t.exports=n},{}],38:[function(e,t){function n(e){var t=e.width(),n=e.height();return t&&n?t>=n?r.ORIENTATION_LANDSCAPE:r.ORIENTATION_PORTRAIT:void 0}var r=e("../views/constants");t.exports=n},{"../views/constants":66}],39:[function(e,t){t.exports={BeginsWith:e("./begins-with"),CSSTransition:e("./css-transition"),CSSTransformString:e("./css-transform-string"),deduceSyntheticSpread:e("./deduce-synthetic-spread"),EndsWith:e("./ends-with"),escapeJQuerySelector:e("./escape-jquery-selector"),extendedThrottle:e("./extended-throttle"),getOrientation:e("./get-orientation"),isIframeAlive:e("./is-iframe-alive"),isRenditionSpreadPermittedForItem:e("./is-rendition-spread-permitted-for-item"),loadTemplate:e("./load-template"),Margins:e("./margins"),Rect:e("./rect"),RemoveFromString:e("./remove-from-string"),ResolveContentRef:e("./resolve-content-ref"),setStyles:e("./set-styles"),triggerLayout:e("./trigger-layout"),UpdateHtmlFontSize:e("./update-html-font-size")}},{"./begins-with":31,"./css-transform-string":32,"./css-transition":33,"./deduce-synthetic-spread":34,"./ends-with":35,"./escape-jquery-selector":36,"./extended-throttle":37,"./get-orientation":38,"./is-iframe-alive":40,"./is-rendition-spread-permitted-for-item":41,"./load-template":42,"./margins":43,"./rect":44,"./remove-from-string":45,"./resolve-content-ref":46,"./set-styles":47,"./trigger-layout":48,"./update-html-font-size":49}],40:[function(e,t){function n(e){var t=void 0,n=void 0;try{t=e.contentWindow,n=e.contentDocument}catch(r){return console.error(r),!1}return t&&n}t.exports=n},{}],41:[function(e,t){function n(e,t){var n=e.getRenditionSpread();return!n||n==r.RENDITION_SPREAD_BOTH||n==r.RENDITION_SPREAD_AUTO||n==r.RENDITION_SPREAD_LANDSCAPE&&t==i.ORIENTATION_LANDSCAPE||n==r.RENDITION_SPREAD_PORTRAIT&&t==i.ORIENTATION_PORTRAIT}var r=e("../models/spine-item-constants"),i=e("../views/constants");t.exports=n},{"../models/spine-item-constants":57,"../views/constants":66}],42:[function(e,t){function n(e){return n.cache[e]}n.cache={fixed_book_frame:'<div id="fixed-book-frame" class="clearfix book-frame fixed-book-frame"></div>',single_page_frame:'<div><div id="scaler"><iframe scrolling="no" class="iframe-fixed"></iframe></div></div>',scrolled_book_frame:'<div id="reflowable-book-frame" class="clearfix book-frame reflowable-book-frame"><div id="scrolled-content-frame"></div></div>',reflowable_book_frame:'<div id="reflowable-book-frame" class="clearfix book-frame reflowable-book-frame"></div>',reflowable_book_page_frame:'<div id="reflowable-content-frame" class="reflowable-content-frame"><iframe scrolling="no" id="epubContentIframe"></iframe></div>'},t.exports=n},{}],43:[function(e,t){function n(e,t,n){this.margin=e,this.border=t,this.padding=n,this.left=this.margin.left+this.border.left+this.padding.left,this.right=this.margin.right+this.border.right+this.padding.right,this.top=this.margin.top+this.border.top+this.padding.top,this.bottom=this.margin.bottom+this.border.bottom+this.padding.bottom,this.width=function(){return this.left+this.right},this.height=function(){return this.top+this.bottom}}n.fromElement=function(e){return new this(e.margin(),e.border(),e.padding())},n.empty=function(){return new this({left:0,right:0,top:0,bottom:0},{left:0,right:0,top:0,bottom:0},{left:0,right:0,top:0,bottom:0})},t.exports=n},{}],44:[function(e,t){function n(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r,this.right=function(){return this.left+this.width},this.bottom=function(){return this.top+this.height},this.isOverlap=function(e,t){return void 0==t&&(t=0),!(e.right()<this.left+t||e.left>this.right()-t||e.bottom()<this.top+t||e.top>this.bottom()-t)}}n.fromElement=function(e){var t;t=_.isArray(e)||e instanceof jQuery?e[0]:e,3===t.nodeType&&(t=e.parent()[0]);for(var r=t.offsetLeft,i=t.offsetTop,o=t.offsetWidth,a=t.offsetHeight;t=t.offsetParent;)r+=t.offsetLeft,i+=t.offsetTop;return new n(r,i,o,a)},t.exports=n},{}],45:[function(e,t){function n(e,t){var n=e.indexOf(t);return-1==n?e:e.substring(0,n)+e.substring(n+t.length)}t.exports=n},{}],46:[function(e,t){function n(e,t){if(!t)return e;var n=t.split("/");n.pop();for(var r=e.split("/");n.length>0&&".."===r[0];)n.pop(),r.splice(0,1);var i=n.concat(r);return i.join("/")}t.exports=n},{}],47:[function(e,t){function n(e,t){var n=e.length;if(n)for(var r=0;n>r;r++){var i=e[r];i.selector?$(i.selector,t).css(i.declarations):t.css(i.declarations)}}t.exports=n},{}],48:[function(e,t){function n(e){var t=e[0].contentDocument;if(t){var n=void 0;try{if(n=t.styleSheets&&t.styleSheets.length?t.styleSheets[0]:void 0,!n){var r=t.createElement("style");t.head.appendChild(r),r.appendChild(t.createTextNode("")),n=r.sheet}n&&n.insertRule("body:first-child::before {content:'READIUM';color: red;font-weight: bold;}",n.cssRules.length)}catch(i){console.error(i)}try{var o=t.createElementNS("http://www.w3.org/1999/xhtml","style");o.appendChild(t.createTextNode("*{}")),t.body.appendChild(o),t.body.removeChild(o),n&&n.deleteRule(n.cssRules.length-1)}catch(i){console.error(i)}if(t.body){t.body.offsetTop}}}t.exports=n},{}],49:[function(e,t){function n(e,t){for(var n,i=t/100,o=e[0].ownerDocument.defaultView,a=r("p, div, span, h1, h2, h3, h4, h5, h6, li, blockquote, td, pre",e),s=0;s<a.length;s++){var u=a[s],c=u.getAttribute("data-original-font-size");if(!c){var l=o.getComputedStyle(u),f=parseInt(l.fontSize);n=parseInt(l.lineHeight),u.setAttribute("data-original-font-size",f),n&&u.setAttribute("data-original-line-height",n)}}n=0;for(var s=0;s<a.length;s++){var u=a[s],c=u.getAttribute("data-original-font-size"),h=u.getAttribute("data-original-line-height"),f=Number(c);n=h?Number(h):0,u.style.fontSize=f*i+"px",n&&(u.style.lineHeight=n*i+"px")}e.css("font-size",t+"%")}var r=e("zepto");e("../../../lib/jquery-sizes"),t.exports=n},{"../../../lib/jquery-sizes":2,zepto:11}],50:[function(e,t){var n=e("underscore"),r=e("backbone"),i={Views:e("./views"),Events:e("./events"),version:function(){return"0.8.0"}};e("./navigator-shim"),n.extend(i,r.Events),t.exports=i},{"./events":30,"./navigator-shim":64,"./views":68,backbone:7,underscore:10}],51:[function(e,t){t.exports={CURRENT_VIEW_PAGINATION_CHANGED:"CurrentViewPaginationChanged"}},{}],52:[function(e,t){function n(e,t){this.idref=e,this.contentCFI=t,this.toString=function(){return JSON.stringify(this)}}t.exports=n},{}],53:[function(e,t){function n(e,t){this.isRightToLeft=e.isRightToLeft(),this.isFixedLayout=t,this.spineItemCount=e.items.length,this.openPages=[],this.addOpenPage=function(e,t,n,r){this.openPages.push({spineItemPageIndex:e,spineItemPageCount:t,idref:n,spineItemIndex:r}),this.sort()},this.canGoLeft=function(){return this.isRightToLeft?this.canGoNext():this.canGoPrev()},this.canGoRight=function(){return this.isRightToLeft?this.canGoPrev():this.canGoNext()},this.canGoNext=function(){if(0==this.openPages.length)return!1;var t=this.openPages[this.openPages.length-1];return t.spineItemIndex<e.last().index||t.spineItemPageIndex<t.spineItemPageCount-1},this.canGoPrev=function(){if(0==this.openPages.length)return!1;var t=this.openPages[0];return e.first().index<t.spineItemIndex||0<t.spineItemPageIndex},this.sort=function(){this.openPages.sort(function(e,t){return e.spineItemIndex!=t.spineItemIndex?e.spineItemIndex-t.spineItemIndex:e.pageIndex-t.pageIndex})}}t.exports=n},{}],54:[function(e,t){var n=function(e){this["package"]=e,this.parallelAt=function(e){for(var t=0,n=0;n<this.smil_models.length;n++){var r=this.smil_models[n],i=e-t,o=r.parallelAt(i);if(o)return o;t+=r.durationMilliseconds_Calculated()}return void 0},this.percentToPosition=function(e,t,n,r){(0>e||e>100)&&(e=0);var i=this.durationMilliseconds_Calculated(),o=i*(e/100);if(n.par=this.parallelAt(o),n.par){var a=n.par.getSmil();if(a){for(var s=0,u=0;u<this.smil_models.length&&(t.smilData=this.smil_models[u],t.smilData!=a);u++)s+=t.smilData.durationMilliseconds_Calculated();r.milliseconds=o-(s+t.smilData.clipOffset(n.par))}}},this.durationMilliseconds_Calculated=function(){for(var e=0,t=0;t<this.smil_models.length;t++){var n=this.smil_models[t];e+=n.durationMilliseconds_Calculated()}return e},this.smilAt=function(e){return 0>e||e>=this.smil_models.length?void 0:this.smil_models[e]},this.positionToPercent=function(e,t,n){if(e>=this.smil_models.length)return-1;for(var r=0,i=0;e>i;i++){var o=this.smil_models[i];r+=o.durationMilliseconds_Calculated()}var a=this.smil_models[e],s=a.nthParallel(t);if(!s)return-1;var u=r+a.clipOffset(s)+n,c=this.durationMilliseconds_Calculated(),l=u/c*100;return l},this.smil_models=[],this.skippables=[],this.escapables=[],this.duration=void 0,this.narrator=void 0,this.activeClass=void 0,this.playbackActiveClass=void 0,this.DEBUG=!1,this.getSmilBySpineItem=function(e){if(!e)return void 0;for(var t=0,n=this.smil_models.length;n>t;t++){var r=this.smil_models[t];if(r.spineItemId===e.idref)return e.media_overlay_id!==r.id&&console.error("SMIL INCORRECT ID?? "+e.media_overlay_id+" /// "+r.id),r}return void 0},this.getNextSmil=function(e){var t=this.smil_models.indexOf(e);return-1==t||t==this.smil_models.length-1?void 0:this.smil_models[t+1]},this.getPreviousSmil=function(e){var t=this.smil_models.indexOf(e);return-1==t||0==t?void 0:this.smil_models[t-1]}};n.fromDTO=function(e,t){var r=new n(t);if(!e)return console.debug("No Media Overlay."),r;console.debug("Media Overlay INIT..."),r.duration=e.duration,r.duration&&r.duration.length&&r.duration.length>0&&(console.error("SMIL total duration is string, parsing float... ("+r.duration+")"),r.duration=parseFloat(r.duration)),r.DEBUG&&console.debug("Media Overlay Duration (TOTAL): "+r.duration),r.narrator=e.narrator,r.DEBUG&&console.debug("Media Overlay Narrator: "+r.narrator),r.activeClass=e.activeClass,r.DEBUG&&console.debug("Media Overlay Active-Class: "+r.activeClass),r.playbackActiveClass=e.playbackActiveClass,r.DEBUG&&console.debug("Media Overlay Playback-Active-Class: "+r.playbackActiveClass);var i=e.smil_models.length;r.DEBUG&&console.debug("Media Overlay SMIL count: "+i);for(var o=0;i>o;o++){var a=SmilModel.fromSmilDTO(e.smil_models[o],r);r.smil_models.push(a),r.DEBUG&&console.debug("Media Overlay Duration (SPINE ITEM): "+a.duration)}i=e.skippables.length,r.DEBUG&&console.debug("Media Overlay SKIPPABLES count: "+i);for(var o=0;i>o;o++)r.skippables.push(e.skippables[o]);i=e.escapables.length,r.DEBUG&&console.debug("Media Overlay ESCAPABLES count: "+i);for(var o=0;i>o;o++)r.escapables.push(e.escapables[o]);return r},t.exports=n},{}],55:[function(e,t){var n=e("../helpers"),r=e("./media-overlay"),i=e("./spine"),o=e("./spine-item-constants"),a=function(e){var t=this;this.spine=void 0,this.rootUrl=void 0,this.rootUrlMO=void 0,this.media_overlay=void 0,this.rendition_viewport=void 0,this.rendition_flow=void 0,this.rendition_layout=void 0,this.rendition_spread=void 0,this.rendition_orientation=void 0,this.resolveRelativeUrlMO=function(e){return t.rootUrlMO&&t.rootUrlMO.length>0?n.EndsWith(t.rootUrlMO,"/")?t.rootUrlMO+e:t.rootUrlMO+"/"+e:t.resolveRelativeUrl(e)},this.resolveRelativeUrl=function(e){return t.rootUrl?n.EndsWith(t.rootUrl,"/")?t.rootUrl+e:t.rootUrl+"/"+e:e},this.isFixedLayout=function(){return t.rendition_layout===o.RENDITION_LAYOUT_PREPAGINATED},this.isReflowable=function(){return!t.isFixedLayout()},e&&(this.rootUrl=e.rootUrl,this.rootUrlMO=e.rootUrlMO,this.rendition_viewport=e.rendition_viewport,this.rendition_layout=e.rendition_layout,this.rendition_flow=e.rendition_flow,this.rendition_orientation=e.rendition_orientation,this.rendition_spread=e.rendition_spread,this.spine=new i(this,e.spine),this.media_overlay=r.fromDTO(e.media_overlay,this))};t.exports=a},{"../helpers":39,"./media-overlay":54,"./spine":59,"./spine-item-constants":57}],56:[function(e,t){var n=function(e,t){this.spineItem=e,this.spineItemPageIndex=void 0,this.elementId=void 0,this.elementCfi=void 0,this.firstPage=!1,this.lastPage=!1,this.initiator=t,this.reset=function(){this.spineItemPageIndex=void 0,this.elementId=void 0,this.elementCfi=void 0,this.firstPage=!1,this.lastPage=!1},this.setFirstPage=function(){this.reset(),this.firstPage=!0},this.setLastPage=function(){this.reset(),this.lastPage=!0},this.setPageIndex=function(e){this.reset(),this.spineItemPageIndex=e},this.setElementId=function(e){this.reset(),this.elementId=e},this.setElementCfi=function(e){this.reset(),this.elementCfi=e}};t.exports=n},{}],57:[function(e,t){t.exports={RENDITION_LAYOUT_REFLOWABLE:"reflowable",RENDITION_LAYOUT_PREPAGINATED:"pre-paginated",RENDITION_ORIENTATION_LANDSCAPE:"landscape",RENDITION_ORIENTATION_PORTRAIT:"portrait",RENDITION_ORIENTATION_AUTO:"auto",SPREAD_LEFT:"page-spread-left",SPREAD_RIGHT:"page-spread-right",SPREAD_CENTER:"page-spread-center",RENDITION_SPREAD_NONE:"none",RENDITION_SPREAD_LANDSCAPE:"landscape",RENDITION_SPREAD_PORTRAIT:"portrait",RENDITION_SPREAD_BOTH:"both",RENDITION_SPREAD_AUTO:"auto",RENDITION_FLOW_PAGINATED:"paginated",RENDITION_FLOW_SCROLLED_CONTINUOUS:"scrolled-continuous",RENDITION_FLOW_SCROLLED_DOC:"scrolled-doc",RENDITION_FLOW_AUTO:"auto"}},{}],58:[function(e,t){var n=e("./spine-item-constants"),r=function(e,t,r){function i(){a.page_spread&&a.page_spread!=n.SPREAD_LEFT&&a.page_spread!=n.SPREAD_RIGHT&&a.page_spread!=n.SPREAD_CENTER&&console.error(a.page_spread+" is not a recognized spread type")}function o(e,t){return a[e]?a[e]===t:a.spine["package"][e]?a.spine["package"][e]===t:!1}var a=this;this.idref=e.idref,this.href=e.href,this.linear=e.linear?e.linear.toLowerCase():e.linear,this.page_spread=e.page_spread,this.rendition_viewport=e.rendition_viewport,this.rendition_spread=e.rendition_spread,this.rendition_orientation=e.rendition_orientation,this.rendition_layout=e.rendition_layout,this.rendition_flow=e.rendition_flow,this.media_overlay_id=e.media_overlay_id,this.media_type=e.media_type,this.index=t,this.spine=r,i(),this.setSpread=function(e){this.page_spread=e,i()},this.isRenditionSpreadAllowed=function(){var e=a.getRenditionSpread();return!e||e!=n.RENDITION_SPREAD_NONE},this.isLeftPage=function(){return a.page_spread==n.SPREAD_LEFT},this.isRightPage=function(){return a.page_spread==n.SPREAD_RIGHT},this.isCenterPage=function(){return a.page_spread==n.SPREAD_CENTER},this.isReflowable=function(){return!a.isFixedLayout()},this.isFixedLayout=function(){var e=a.getRenditionLayout();if(e){if(a.rendition_layout){if(a.rendition_layout===n.RENDITION_LAYOUT_PREPAGINATED)return!0;if(a.rendition_layout===n.RENDITION_LAYOUT_REFLOWABLE)return!1}return a.spine["package"].isFixedLayout()}return a.media_type.indexOf("image/")>=0},this.getRenditionFlow=function(){return a.rendition_flow?a.rendition_flow:a.spine["package"].rendition_flow},this.getRenditionViewport=function(){return a.rendition_viewport?a.rendition_viewport:a.spine["package"].rendition_viewport},this.getRenditionSpread=function(){return a.rendition_spread?a.rendition_spread:a.spine["package"].rendition_spread},this.getRenditionOrientation=function(){return a.rendition_orientation?a.rendition_orientation:a.spine["package"].rendition_orientation},this.getRenditionLayout=function(){return a.rendition_layout?a.rendition_layout:a.spine["package"].rendition_layout},this.isFlowScrolledContinuous=function(){return o("rendition_flow",n.RENDITION_FLOW_SCROLLED_CONTINUOUS)},this.isFlowScrolledDoc=function(){return o("rendition_flow",n.RENDITION_FLOW_SCROLLED_DOC)}};r.alternateSpread=function(e){return e===n.SPREAD_LEFT?n.SPREAD_RIGHT:e===n.SPREAD_RIGHT?n.SPREAD_LEFT:e},t.exports=r},{"./spine-item-constants":57}],59:[function(e,t){function n(e,t){function n(e){return!l||"no"!==e.linear}function o(e){if(!s(e))return void 0;var t=c.items[e];return n(t)?t:o(t.index+1)}function a(e){if(!s(e))return void 0;var t=c.items[e];return n(t)?t:a(t.index-1)}function s(e){return e>=0&&e<c.items.length}function u(){for(var e=c.items.length,t=!1,n=c.isLeftToRight()?i.SPREAD_LEFT:i.SPREAD_RIGHT,o=0;e>o;o++){var a=c.items[o];if(!a.page_spread){var s=a.isRenditionSpreadAllowed()?t?n:r.alternateSpread(n):i.SPREAD_CENTER;a.setSpread(s)}t=!a.isRenditionSpreadAllowed()||a.page_spread!=n}}var c=this;this.items=[],this.direction="ltr",this["package"]=e;var l=!1;if(this.handleLinear=function(e){l=e},this.isValidLinearItem=function(e){return s(e)?n(this.item(e)):void 0},this.prevItem=function(e){return a(e.index-1)},this.nextItem=function(e){return o(e.index+1)},this.getItemUrl=function(e){return c["package"].resolveRelativeUrl(e.href)},this.first=function(){return o(0)},this.last=function(){return a(this.items.length-1)},this.isFirstItem=function(e){return c.first()===e},this.isLastItem=function(e){return c.last()===e},this.item=function(e){return s(e)?c.items[e]:void 0},this.isRightToLeft=function(){return"rtl"==c.direction},this.isLeftToRight=function(){return!c.isRightToLeft()},this.getItemById=function(e){for(var t=c.items.length,n=0;t>n;n++)if(c.items[n].idref==e)return c.items[n];return void 0},this.getItemByHref=function(e){for(var t=c.items.length,n=0;t>n;n++)if(c.items[n].href==e)return c.items[n];return void 0},t){t.direction&&(this.direction=t.direction);for(var f=t.items.length,h=0;f>h;h++){var d=new r(t.items[h],h,this);this.items.push(d)}u()}}var r=e("./spine-item"),i=e("./spine-item-constants");t.exports=n},{"./spine-item":58,"./spine-item-constants":57}],60:[function(e,t){var n=function(e,t){this.selector=e,this.declarations=t,this.setDeclarations=function(e){for(var t in e)e.hasOwnProperty(t)&&(this.declarations[t]=e[t])}};t.exports=n},{}],61:[function(e,t){function n(e){function t(e){var t=e.attributes["required-namespace"];if(!t)return console.log("Encountered a case statement with no required-namespace"),!1;var n=["http://www.w3.org/1998/Math/MathML"];return _.include(n,t)}r("switch",e).each(function(){var e=!1;r("case",this).each(function(){!e&&t(this)?e=!0:r(this).remove()}),e&&r("default",this).remove()})}var r=e("zepto");t.exports={apply:n}},{zepto:11}],62:[function(e,t){var n=e("zepto"),r=e("../helpers/escape-jquery-selector"),i=e("./trigger"),i=function(e){var t=n(e);this.action=t.attr("action"),this.ref=t.attr("ref"),this.event=t.attr("ev:event"),this.observer=t.attr("ev:observer"),this.ref=t.attr("ref")};i.register=function(e){n("trigger",e).each(function(){var t=new i(this);t.subscribe(e)})},i.prototype.subscribe=function(e){var t="#"+this.observer,r=this;n(t,e).on(this.event,function(){r.execute(e)})},i.prototype.execute=function(e){var t=n("#"+r(this.ref),e);switch(this.action){case"show":t.css("visibility","visible");break;case"hide":t.css("visibility","hidden");break;case"play":t[0].currentTime=0,t[0].play();break;case"pause":t[0].pause();break;case"resume":t[0].play();break;case"mute":t[0].muted=!0;break;case"unmute":t[0].muted=!1;break;default:console.log("do not no how to handle trigger "+this.action)}},t.exports=i},{"../helpers/escape-jquery-selector":36,"./trigger":62,zepto:11}],63:[function(e,t){var n=function(e){function t(e){for(var t=[],n=e.split(/[\s,;]+/),r=0;r<n.length;r++){var i=n[r].trim();""!==i&&t.push(i)}return t}function n(e,t,n){void 0!==t[e]&&(r[e]=n?n(t[e]):t[e])}var r=this;this.syntheticSpread="auto",this.fontSize=100,this.columnGap=20,this.mediaOverlaysPreservePlaybackWhenScroll=!1,this.mediaOverlaysSkipSkippables=!1,this.mediaOverlaysEscapeEscapables=!0,this.mediaOverlaysSkippables=[],this.mediaOverlaysEscapables=[],this.mediaOverlaysEnableClick=!0,this.mediaOverlaysRate=1,this.mediaOverlaysVolume=100,this.mediaOverlaysSynchronizationGranularity="",this.mediaOverlaysAutomaticPageTurn=!0,this.enableGPUHardwareAccelerationCSS3D=!1,this.pageTransition=-1,this.scroll="auto",this.update=function(e){n("columnGap",e),n("fontSize",e),n("mediaOverlaysPreservePlaybackWhenScroll",e),n("mediaOverlaysSkipSkippables",e),n("mediaOverlaysEscapeEscapables",e),n("mediaOverlaysSkippables",e,t),n("mediaOverlaysEscapables",e,t),n("mediaOverlaysEnableClick",e),n("mediaOverlaysRate",e),n("mediaOverlaysVolume",e),n("mediaOverlaysSynchronizationGranularity",e),n("mediaOverlaysAutomaticPageTurn",e),n("scroll",e),n("syntheticSpread",e),n("pageTransition",e),n("enableGPUHardwareAccelerationCSS3D",e)},this.update(e)};t.exports=n},{}],64:[function(){navigator&&(navigator.epubReadingSystem={name:"",version:"0.0.0",layoutStyle:"paginated",hasFeature:function(e,t){return t&&"1.0"!==t?!1:"dom-manipulation"===e?!0:"layout-changes"===e?!0:"touch-events"===e?!1:"mouse-events"===e?!0:"keyboard-events"===e?!0:"spine-scripting"===e?!0:!1}})},{}],65:[function(e,t){function n(e,t,n){function o(){return n.paginationInfo&&!!n.paginationInfo.rightToLeft}function a(){return n.paginationInfo&&!!n.paginationInfo.isVerticalWritingMode}function s(e,t,n){return n?e.top>=0&&e.top<t.height:e.left>=0&&e.left<t.width}function u(){return!n.paginationInfo||a()?t.width():n.paginationInfo.columnWidth+n.paginationInfo.columnGap}function c(){return a()?{top:n.paginationInfo?n.paginationInfo.pageOffset:0}:{left:(n.paginationInfo?n.paginationInfo.pageOffset:0)*(o()?-1:1)}}function l(e,t,n){var r=i.fromElement(e);_.isNaN(r.left)&&(r=new i(e.position().top,e.position().left,0,0));var o=t.top||0,a=r.bottom()>o,s=void 0!==t.bottom?r.top<t.bottom:!0,u=0;return a&&s?n?(r.top<=o&&(u=Math.ceil(100*(o-r.top)/r.height)),100-u):100:0}function f(e,n,r){var i=p(e),c=i.clientRectangles;if(0===c.length)return null;var l=o(),f=a(),h=u(),g={width:t.width(),height:t.height()};1===c.length&&v(c[0],g,h,l,f,!0);for(var m=0,y=0,b=c.length;b>y;++y)if(s(c[y],g,f)){m=r?d(c,y):100;break}return m}function h(e,r){var i=c(),s=p(e,i),l=s.clientRectangles;if(0===l.length)return null;var f=o(),h=a(),d=u(),g=t.height(),m=t.width();r&&y(l,r,g,d,f,h);var b=_.first(l);1===l.length&&v(b,{height:g,width:m},d,f,h);var w;if(h){var x=b.top;w=Math.floor(x/g)}else{var I=b.left;f&&(I=d*(n.paginationInfo?n.paginationInfo.visibleColumnCount:1)-I),w=Math.floor(I/d)}return 0>w?w=0:w>=(n.paginationInfo?n.paginationInfo.columnCount:1)&&(w=n.paginationInfo?n.paginationInfo.columnCount-1:0),w}function d(e,t){var n=0,r=0;return e.length>1?_.each(e,function(e,i){n+=e.height,i>=t&&(r+=e.height)}):(n=e[0].height,r=e[0].height-Math.max(0,-e[0].top)),r===n?100:Math.floor(100*r/n)}function p(e,t){t=t||{};for(var n=t.left||0,r=t.top||0,i=g(e[0].getBoundingClientRect(),n,r),o=[],a=e[0].getClientRects(),s=0,u=a.length;u>s;++s)a[s].height>0&&o.push(g(a[s],n,r));return 0===o.length&&(e=e.next(),e.length)?p(e,t):{wrapperRectangle:i,clientRectangles:o}}function g(e,t,n){var r={left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.right-e.left,height:e.bottom-e.top};return m(r,t,n),r}function m(e,t,n){e.left+=t,e.right+=t,e.top+=n,e.bottom+=n}function v(e,t,n,r,i,o){if(!i){for(r&&(n*=-1);e.top<0;)m(e,-n,t.height);if(o)for(;e.bottom>=t.height&&!s(e,t,i);)m(e,n,-t.height)}}function y(e,t,n,r,i,o){if(!o){var a=_.reduce(e,function(e,t){return e+t.height},0),s=a*t/100;if(e.length>1){var u=0;do{if(u+=e[0].height,u>s)break;e.shift()}while(e.length>1)}else{for(i&&(r*=-1);e[0].bottom>=n;)m(e[0],r,-n);e[0].top+=s,e[0].height-=s}}}function b(e,n,r,i){var o=t[0].contentDocument,a="epubcfi("+e+")",s=EPUBcfi.getTargetElementWithPartialCFI(a,o,n,r,i);return s&&0!=s.length?s:void console.log("Can't find element for CFI: "+e)}function w(e){var t={cfi:"",x:0,y:0},n=e.indexOf("@");if(-1!=n){var r=e.substring(n+1),i=r.indexOf(":");-1!=i?(t.x=parseInt(r.substr(0,i)),t.y=parseInt(r.substr(i+1))):console.log("Unexpected terminating step format"),t.cfi=e.substring(0,n)}else t.cfi=e;return t}function x(e){if(e.nodeType===Node.TEXT_NODE){var t=e.nodeValue.replace(/\n/g,"");return t=t.replace(/ /g,""),t.length>0}return!1}n=n||{},this.getRootElement=function(){return t[0].contentDocument.documentElement};var I=n.rectangleBased?f:l;this.findFirstVisibleElement=function(e){"object"!=typeof e&&(e={top:e});var t,n=null,i=0;return t=r("body",this.getRootElement()).find(":not(iframe)").contents().filter(function(){return x(this)||"img"===this.nodeName.toLowerCase()}),r.each(t,function(){var t;t=this.nodeType===Node.TEXT_NODE?r(this).parent():r(this);var o=I(t,e,!0);return o?(n=t,i=100-o,!1):!0}),{$element:n,percentY:i}},this.getFirstVisibleElementCfi=function(e){var t=this.findFirstVisibleElement(e);if(!t.$element)return void console.log("Could not generate CFI no visible element on page");var n=EPUBcfi.Generator.generateElementCFIComponent(t.$element[0]);return"!"==n[0]&&(n=n.substring(1)),n+"@0:"+t.percentY},this.getPageForElementCfi=function(e,t,n,r){var i=w(e),o=b(i.cfi,t,n,r);return o?this.getPageForPointOnElement(o,i.x,i.y):-1},this.getElementByCfi=function(e,t,n,r){var i=w(e);return b(i.cfi,t,n,r)},this.getPageForElement=function(e){return this.getPageForPointOnElement(e,0,0)},this.getPageForPointOnElement=function(t,r,i){var o;if(n.rectangleBased)return o=h(t,i),null===o?(console.warn("Impossible to locate a hidden element: ",t),0):o;var a=this.getVerticalOffsetForPointOnElement(t,r,i);return Math.floor(a/e.height())},this.getVerticalOffsetForElement=function(e){return this.getVerticalOffsetForPointOnElement(e,0,0)
},this.getVerticalOffsetForPointOnElement=function(e,t,n){var r=i.fromElement(e);return Math.ceil(r.top+n*r.height/100)},this.getElementById=function(e){var n=t[0].contentDocument,i=r(n.getElementById(e));return 0==i.length?void 0:i},this.getPageForElementId=function(e){var t=this.getElementById(e);return t?this.getPageForElement(t):-1},this.getFirstVisibleMediaOverlayElement=function(e){function t(n){if(!n||!n.length)return void 0;for(var i=0,s=n.length;s>i;i++){var u=n[i];if(u){var c=r(u);if(c.data("mediaOverlayData")){var l=o.getElementVisibility(c,e);if(l&&(a||(a=u),100==l))return u}else{var f=t(u.children);if(f)return f}}}return void 0}var n=this.getRootElement();if(!n)return void 0;var i=r("body",n);if(!i||!i.length||!i[0])return void 0;var o=this,a=void 0,s=t([i[0]]);return s||(s=a),s},this.getElementVisibility=function(e,t){return I(e,t,!0)},this.isElementVisible=I,this.getAllVisibleElementsWithSelector=function(e,t){var n=r(e,this.getRootElement()).filter(function(){return!0}),i=[];r.each(n,function(){i.push(r(this))});var o=this.getVisibleElements(i,t);return o},this.getVisibleElements=function(e,t){var n=[];return r.each(e,function(){var e=this,r=I(e,t,!0);if(r){var i=e;return n.push({element:i[0],percentVisible:r}),!0}return null===r?!0:0===n.length}),n},this.getVisibleTextElements=function(e){var t=this.getTextElements(r("body",this.getRootElement()));return this.getVisibleElements(t,e)},this.getMediaOverlayElements=function(e){function t(e){if(void 0!=e)for(var i=0,o=e.length;o>i;i++){var a=r(e[i]);a.data("mediaOverlayData")?n.push(a):t(a[0].children)}}var n=[];return t([e[0]]),n},this.getTextElements=function(e){var t=[];return e.find(":not(iframe)").contents().each(function(){x(this)&&t.push(r(this).parent())}),t},this.getElement=function(e){var t=r(e,this.getRootElement());return t.length>0?t:void 0}}var r=e("zepto"),i=e("../helpers/rect");t.exports=n},{"../helpers/rect":44,zepto:11}],66:[function(e,t){t.exports={ORIENTATION_LANDSCAPE:"orientation_landscape",ORIENTATION_PORTRAIT:"orientation_portrait"}},{}],67:[function(e,t){function n(){var e=this,t={};this.addIFrameEventListener=function(e,n,r){void 0==t[e]&&(t[e]=[]),t[e].push({callback:n,context:r})},this.updateIframeEvents=function(e){i.each(t,function(t,n){for(var i=0,o=t.length;o>i;i++)r(e.contentWindow).off(n),r(e.contentWindow).on(n,t[i].callback,t[i].context)})},this.loadIframe=function(t,n,i,a,s){t.setAttribute("data-baseUri",t.baseURI),t.setAttribute("data-src",n);var u=new o(n).absoluteTo(t.baseURI).toString();e._loadIframeWithUri(t,s,u,function(){var e=t.contentDocument||t.contentWindow.document;r("svg",e).load(function(){console.log("loaded")}),i.call(a,!0,s)})},this._loadIframeWithUri=function(t,n,r,o){t.onload=function(){e.updateIframeEvents(t);var n=t.contentWindow.MathJax;if(n){var r=i.once(o);try{n.Hub.Queue(r)}catch(a){console.error("MathJax fail!"),o()}}else o()},t.setAttribute("src",r)}}var r=e("zepto"),i=e("underscore"),o=e("URIjs");t.exports=n},{URIjs:5,underscore:10,zepto:11}],68:[function(e,t){var n=e("underscore"),r={IFrameLoader:e("./iframe-loader"),ReaderView:e("./reader-view")},i=e("./constants");n.extend(r,i),t.exports=r},{"./constants":66,"./iframe-loader":67,"./reader-view":69,underscore:10}],69:[function(e,t){function n(e){function t(e){return"scroll-doc"==j.scroll?x:"scroll-continuous"==j.scroll?I:e.isFixedLayout()?w:e.isFlowScrolledDoc()?x:e.isFlowScrolledContinuous()?I:_}function n(e,n){var r=t(e);if(console.log("desiredViewType",r),D){if(N.getCurrentViewType()==r)return void n(!1);E()}var i={$viewport:C,spine:L,userStyles:z,bookStyles:U,iframeLoader:O};D=N.createViewForType(r,i),N.trigger(a.READER_VIEW_CREATED,r),D.on(a.CONTENT_DOCUMENT_LOADED,function(e,t){if(l(e[0])){var n=e[0].contentDocument;y.register(n),v.apply(n),N.trigger(a.CONTENT_DOCUMENT_LOADED,e,t)}}),D.on(a.CONTENT_DOCUMENT_LOAD_START,function(e,t){N.trigger(a.CONTENT_DOCUMENT_LOAD_START,e,t)}),D.on(c.CURRENT_VIEW_PAGINATION_CHANGED,function(e){N.trigger(a.PAGINATION_CHANGED,e)}),D.on(a.FXL_VIEW_RESIZED,function(){N.trigger(a.FXL_VIEW_RESIZED)}),D.render(),D.setViewSettings(j),setTimeout(function(){n(!0)},50)}function E(){D&&(N.trigger(a.READER_VIEW_DESTROYED),D.off(c.CURRENT_VIEW_PAGINATION_CHANGED),D.remove(),D=void 0)}function T(e){if(!e)return void console.log("idref parameter value missing!");var t=L.getItemById(e);return t?t:void console.log("Spine item with id "+e+" not found!")}function P(e,t){n(e.spineItem,function(n){n||D.setViewSettings(j),D.openPage(e,t)})}function S(e){g(z.getStyles(),C),e||D&&D.applyStyles()}function A(){B=null,V=!1,D&&(D.isReflowable&&D.isReflowable()&&(V=N.isPlayingMediaOverlay(),V&&N.pauseMediaOverlay()),B=D.bookmarkCurrentPage())}function R(){D&&N.handleViewportResize(B)}function k(){R(),V&&N.playMediaOverlay()}r.extend(this,o.Events);var O,C,N=this,D=void 0,F=void 0,L=void 0,j=new b({}),z=new m,U=new m,M=s(A,R,k,250,1e3,N);i(window).on("resize.ReadiumSDK.readerView",M),e.el instanceof i?(C=e.el,console.log("** EL is a jQuery selector:"+e.el.attr("id"))):(C=i(e.el),console.log("** EL is a string:"+C.attr("id"))),O=e.iframeLoader?e.iframeLoader:new u({mathJaxUrl:e.mathJaxUrl}),_needsFixedLayoutScalerWorkAround=e.needsFixedLayoutScalerWorkAround,this.needsFixedLayoutScalerWorkAround=function(){return _needsFixedLayoutScalerWorkAround},this.createViewForType=function(e,t){var n;return C.css("overflow","hidden"),n=new d(t,N)},this.getCurrentViewType=function(){return D?D instanceof d?_:D instanceof FixedView?w:D instanceof ScrollView?D.isContinuousScroll()?I:x:void console.error("Unrecognized view type"):void 0},this.getLoadedSpineItems=function(){return D?D.getLoadedSpineItems():[]},this.viewerSettings=function(){return j},this["package"]=function(){return F},this.spine=function(){return L},this.userStyles=function(){return z},this.openBook=function(e){var t=e["package"]?e["package"]:e;F=new f(t),L=F.spine,L.handleLinear(!0),E(),e.settings&&N.updateSettings(e.settings),e.styles&&N.setStyles(e.styles);var n=void 0;e.openPageRequest&&(e.openPageRequest.idref||e.openPageRequest.contentRefUrl&&e.openPageRequest.sourceFileHref?n=e.openPageRequest:console.log("Invalid page request data: idref required!"));var r=!1;if(n){n=e.openPageRequest;try{r=n.idref?n.spineItemPageIndex?!N.openSpineItemPage(n.idref,n.spineItemPageIndex,N):n.elementCfi?!N.openSpineItemElementCfi(n.idref,n.elementCfi,N):!N.openSpineItemPage(n.idref,0,N):!N.openContentUrl(n.contentRefUrl,n.sourceFileHref,N)}catch(i){console.error("openPageRequest fail: fallback to first page!"),console.log(i),r=!0}}else r=!0;if(r){var o=L.first();if(o){var a=new h(o,N);a.setFirstPage(),P(a,0)}}},this.openPageLeft=function(){F.spine.isLeftToRight()?N.openPagePrev():N.openPageNext()},this.openPageRight=function(){F.spine.isLeftToRight()?N.openPageNext():N.openPagePrev()},this.isCurrentViewFixedLayout=function(){return D instanceof FixedView},this.setZoom=function(e){N.isCurrentViewFixedLayout()&&D.setZoom(e)},this.getViewScale=function(){return N.isCurrentViewFixedLayout()?100*D.getViewScale():100},this.updateSettings=function(e){if(j.update(e),D&&!e.doNotUpdateView){var t=D.bookmarkCurrentPage();if(t&&t.idref){var r=!1;D.isReflowable&&D.isReflowable()&&(r=N.isPlayingMediaOverlay(),r&&N.pauseMediaOverlay());var i=L.getItemById(t.idref);n(i,function(e){e||D.setViewSettings(j),N.openSpineItemElementCfi(t.idref,t.contentCFI,N),r&&N.playMediaOverlay(),N.trigger(a.SETTINGS_APPLIED)})}}N.trigger(a.SETTINGS_APPLIED)},this.openPageNext=function(){if(N.getCurrentViewType()===I)return void D.openPageNext(N);var e=D.getPaginationInfo();if(0!=e.openPages.length){var t=e.openPages[e.openPages.length-1];if(t.spineItemPageIndex<t.spineItemPageCount-1)return void D.openPageNext(N);var n=L.getItemById(t.idref),r=L.nextItem(n);if(r){var i=new h(r,N);i.setFirstPage(),P(i,2)}}},this.openPagePrev=function(){if(N.getCurrentViewType()===I)return void D.openPagePrev(N);var e=D.getPaginationInfo();if(0!=e.openPages.length){var t=e.openPages[0];if(t.spineItemPageIndex>0)return void D.openPagePrev(N);var n=L.getItemById(t.idref),r=L.prevItem(n);if(r){var i=new h(r,N);i.setLastPage(),P(i,1)}}},this.openSpineItemElementCfi=function(e,t,n){var r=T(e);if(!r)return!1;var i=new h(r,n);return t&&i.setElementCfi(t),P(i,0),!0},this.openPageIndex=function(e,t){if(!D)return!1;var n;if(F.isFixedLayout()){var r=L.items[e];if(!r)return!1;n=new h(r,t),n.setPageIndex(0)}else{var i=this.getLoadedSpineItems();i.length>0&&(n=new h(i[0],t),n.setPageIndex(e))}return P(n,0),!0},this.openSpineItemPage=function(e,t,n){var r=T(e);if(!r)return!1;var i=new h(r,n);return t&&i.setPageIndex(t),P(i,0),!0},this.setStyles=function(e,t){for(var n=e.length,r=0;n>r;r++)e[r].declarations?z.addStyle(e[r].selector,e[r].declarations):z.removeStyle(e[r].selector);S(t)},this.setBookStyles=function(e){for(var t=e.length,n=0;t>n;n++)U.addStyle(e[n].selector,e[n].declarations);D&&D.applyBookStyles()},this.getElement=function(e,t){return D?D.getElement(e,t):void 0},this.getElementById=function(e,t){return D?D.getElementById(e,t):void 0},this.getElementByCfi=function(e,t,n,r,i){return D?D.getElementByCfi(e,t,n,r,i):void 0},this.openContentUrl=function(e,t,n){var r,i,o=p(e,t),a=o.indexOf("#");a>=0?(r=o.substr(0,a),i=o.substr(a+1)):(r=o,i=void 0);var s=L.getItemByHref(r);if(!s){console.warn("spineItem "+r+" not found");var u=decodeURIComponent(r);if(s=L.getItemByHref(u),!s)return console.warn("decoded spineItem "+u+" missing as well"),!1}return N.openSpineItemElementId(s.idref,i,n)},this.openSpineItemElementId=function(e,t,n){var r=L.getItemById(e);if(!r)return!1;var i=new h(r,n);return t&&i.setElementId(t),P(i,0),!0},this.bookmarkCurrentPage=function(){return JSON.stringify(D.bookmarkCurrentPage())},this.clearStyles=function(){z.resetStyleValues(),S(),z.clear()},this.clearBookStyles=function(){D&&(U.resetStyleValues(),D.applyBookStyles()),U.clear()},this.insureElementVisibility=function(e,t,n){D&&D.insureElementVisibility(e,t,n)};var B=null,V=!1;this.handleViewportResize=function(e){if(D){var t=e||D.bookmarkCurrentPage();if(D.isReflowable&&D.isReflowable()&&t&&t.idref){var r=L.getItemById(t.idref);n(r,function(){N.openSpineItemElementCfi(t.idref,t.contentCFI,N)})}else D.onViewportResize()}},this.addIFrameEventListener=function(e,t,n){O.addIFrameEventListener(e,t,n)};var q=function(){var e={},t=!1,n=void 0;this.setCallback_PlayPause=function(e){n=e};var r=void 0;this.setCallback_IsAvailable=function(e){r=e},this.playPause=function(e){o(e)};var o=function(t){n&&n(t);try{var r=void 0;for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];if(a&&a.active&&(r&&console.error("More than one active iframe?? (pagination)"),r=a.$iframe)){var s=i("audio",r[0].contentDocument);i.each(s,function(){var e=this.getAttribute("epub:type")||this.getAttribute("type");return e?e.indexOf("ibooks:soundtrack")<0&&e.indexOf("media:soundtrack")<0&&e.indexOf("media:background")<0?!0:(t&&this.play?this.play():this.pause&&this.pause(),!0):!0})}}}catch(u){console.error(u)}};this.setPlayState=function(e){t=e},N.on(a.CONTENT_DOCUMENT_LOADED,function(t,n){try{n&&n.idref&&t&&t[0]&&(e[n.idref]={$iframe:t,href:n.href})}catch(r){console.error(r)}}),N.on(a.PAGINATION_CHANGED,function(n){var a=!1;try{for(var s in e)if(e.hasOwnProperty(s)){var u=n.spineItem&&n.spineItem.idref===s,c=!1;if(n.paginationInfo&&n.paginationInfo.openPages.length){for(var l=!0,f=0;f<n.paginationInfo.openPages.length;f++)n.paginationInfo.openPages[f].idref===s?c=!0:l=!1;!u&&l&&(u=!0)}if(u||c){var h=e[s];if(!h)continue;e[s].active=u;var d=h.$iframe,p=(h.href,i("audio",d[0].contentDocument));i.each(p,function(){var e=this.getAttribute("epub:type")||this.getAttribute("type");return e?e.indexOf("ibooks:soundtrack")<0&&e.indexOf("media:soundtrack")<0&&e.indexOf("media:background")<0?!0:(this.setAttribute("loop","loop"),this.removeAttribute("autoplay"),u||this.pause&&this.pause(),a=!0,!0):!0})}else e[s]&&(e[s].$iframe=void 0),e[s]=void 0}}catch(g){console.error(g)}r&&r(a),o(a?t?!0:!1:!1)}),N.on(a.MEDIA_OVERLAY_STATUS_CHANGED,function(n){if(n.smilIndex){var r=N["package"](),i=r.media_overlay.smilAt(n.smilIndex);if(i&&i.spineItemId){var a=!1;for(var s in e)if(e.hasOwnProperty(s)){var u=e[s];u&&u.active&&s!==i.spineItemId&&(o(!1),u.active=!1,a=!0)}if(a){for(var s in e)if(e.hasOwnProperty(s)){var u=e[s];u&&(u.active||s===i.spineItemId&&(u.active=!0))}t&&o(!0)}}}})};this.backgroundAudioTrackManager=new q}var r=e("underscore"),i=e("zepto"),o=e("backbone"),a=e("../events"),s=e("../helpers/extended-throttle"),u=e("./iframe-loader"),c=e("../internal-events"),l=e("../helpers/is-iframe-alive"),f=e("../models/package"),h=e("../models/page-open-request"),d=e("./reflowable-view"),p=e("../helpers/resolve-content-ref"),g=e("../helpers/set-styles"),m=e("../collections/style"),v=e("../models/switches"),y=e("../models/trigger"),b=e("../models/viewer-settings"),_=1,w=2,x=3,I=4;t.exports=n},{"../collections/style":29,"../events":30,"../helpers/extended-throttle":37,"../helpers/is-iframe-alive":40,"../helpers/resolve-content-ref":46,"../helpers/set-styles":47,"../internal-events":51,"../models/package":55,"../models/page-open-request":56,"../models/switches":61,"../models/trigger":62,"../models/viewer-settings":63,"./iframe-loader":67,"./reflowable-view":70,backbone:7,underscore:10,zepto:11}],70:[function(e,t){function n(e,t){function n(e){L.css("left",e.left+"px"),L.css("top",e.top+"px"),L.css("right",e.right+"px"),L.css("bottom",e.bottom+"px")}function b(){L&&L.remove();var e=h("reflowable_book_page_frame",{}),t=i(e);t=z.append(t),L=i("#reflowable-content-frame",t),U=i("#epubContentIframe",t),U.css("left",""),U.css("right",""),U.css("position","relative"),U.css("overflow","hidden"),j=new s(L,U,{rectangleBased:!0,paginationInfo:tt})}function _(e){if(D!=e){b(),tt.pageOffset=0,tt.currentSpreadIndex=0,D=e,J=!0;var t=G["package"].resolveRelativeUrl(e.href);$.trigger(c.CONTENT_DOCUMENT_LOAD_START,U,e),U.css("opacity","0.01"),X.loadIframe(U[0],t,I,$,{spineItem:e})}}function w(){M&&v(M,Y)}function x(){M&&M.css("column-gap",tt.columnGap+"px")}function I(e){if(J=!1,F&&F.spineItem!=D)return void _(F.spineItem);if(!e)return U.css("opacity","1"),void(F=void 0);$.trigger(c.CONTENT_DOCUMENT_LOADED,U,D);var t=U[0].contentDocument;M=i("html",t),B=i("body",M),window.chrome&&"Google Inc."===window.navigator.vendor&&i("video",B).css("transform","translateZ(0)"),V=!1,q=!0,H=void 0;var n=U[0].contentDocument.defaultView||U[0].contentWindow,r=n.getComputedStyle(B[0],null);if(r){q="ltr"===r.direction;var o=void 0;o=r.getPropertyValue?r.getPropertyValue("-webkit-writing-mode")||r.getPropertyValue("-moz-writing-mode")||r.getPropertyValue("-ms-writing-mode")||r.getPropertyValue("-o-writing-mode")||r.getPropertyValue("-epub-writing-mode")||r.getPropertyValue("writing-mode"):r.webkitWritingMode||r.mozWritingMode||r.msWritingMode||r.oWritingMode||r.epubWritingMode||r.writingMode,o&&(H=o.indexOf("-lr")>=0,(o.indexOf("vertical")>=0||o.indexOf("tb-")>=0||o.indexOf("bt-")>=0)&&(V=!0))}q&&("rtl"===B[0].getAttribute("dir")||"rtl"===M[0].getAttribute("dir"))&&(q=!1),G.isLeftToRight()||!q||V||(B[0].setAttribute("dir","rtl"),q=!1,H=!1),tt.isVerticalWritingMode=V,R(),U.css("opacity","1"),P(),M.css("height",et.height+"px"),M.css("position","relative"),M.css("margin","0"),M.css("padding","0"),M.css("column-axis",V?"vertical":"horizontal"),$.applyBookStyles(),C(),w(),x(),$.applyStyles()}function E(){if(F){var e=F;F=void 0,$.openPage(e)}}function T(){var e=-tt.pageOffset+"px";if(V)M.css("top",e);else{var t=q||H;M.css("left",t?e:""),M.css("right",t?"":e)}k()}function P(){var e=L.width(),t=L.height();return et.width!==e||et.height!==t?(et.width=e,et.height=t,!0):!1}function S(e,t,n){tt.pageOffset=(tt.columnWidth+tt.columnGap)*tt.visibleColumnCount*tt.currentSpreadIndex,T(),$.trigger(f.CURRENT_VIEW_PAGINATION_CHANGED,{paginationInfo:$.getPaginationInfo(),initiator:e,spineItem:t,elementId:n})}function A(){var e=550,t=400,n=l(Q,D,nt),r=n===!1||n===!0;if(0===n&&(n=1),tt.visibleColumnCount=n?2:1,V&&(e*=2,n=!1,r=!0,tt.visibleColumnCount=1),M){R();var i=parseInt(Q.css("border-left-width")),o=parseInt(Q.css("border-right-width")),a=tt.columnGap/2;a=Math.max(0,a-i);var s=tt.columnGap/2;s=Math.max(0,s-o);var u=0;if(nt.fontSize){var c=.8*nt.fontSize/100;e=Math.floor(e*c),t=Math.floor(t*c)}var f=Q.width(),h=f-i-o-a-s;n&&(h=.5*(h-tt.columnGap)),h>e?u=Math.floor((h-e)*(n?1:.5)):!r&&t>h&&n&&(n=!1,tt.visibleColumnCount=1,h=f-i-o-a-s,h>e&&(u=Math.floor(.5*(h-e)))),z.css({left:u+a+"px",right:u+s+"px"}),P(),U.css("width",et.width+"px"),U.css("height",et.height+"px"),M.css("height",et.height+"px"),M.css("min-height",et.height+"px"),M.css("max-height",et.height+"px"),M.css("margin",0),M.css("padding",0),M.css("border",0),B.css("margin",0),B.css("padding",0);var d=0;try{d=parseInt(B.css("padding-top"))+parseInt(B.css("border-top-width"))+parseInt(B.css("border-bottom-width"))}catch(p){}B.css("min-height","50%"),B.css("max-height",et.height-d+"px"),tt.rightToLeft=G.isRightToLeft(),tt.columnWidth=Math.round(((V?et.height:et.width)-tt.columnGap*(tt.visibleColumnCount-1))/tt.visibleColumnCount),M.css("width",(V?et.width:tt.columnWidth)+"px"),M.css("column-width",tt.columnWidth+"px"),M.css({left:"0",right:"0",top:"0"}),g(U),tt.columnCount=((V?M[0].scrollHeight:M[0].scrollWidth)+tt.columnGap)/(tt.columnWidth+tt.columnGap),tt.columnCount=Math.round(tt.columnCount);var m=(tt.columnCount-1)*tt.columnGap,v=((V?M[0].scrollHeight:M[0].scrollWidth)-m)/tt.columnCount;v=Math.round(v),v>tt.columnWidth&&(console.debug("ADJUST COLUMN"),console.log(tt.columnWidth),console.log(v),tt.columnWidth=v),tt.spreadCount=Math.ceil(tt.columnCount/tt.visibleColumnCount),tt.currentSpreadIndex>=tt.spreadCount&&(tt.currentSpreadIndex=tt.spreadCount-1),F?E():S($)}}function R(){-1==K&&(K=M.css("opacity"),M.css("opacity","0"))}function k(){-1!=K&&M.css("opacity",K),K=-1}function O(){for(var e=[],t=tt.currentSpreadIndex*tt.visibleColumnCount,n=0;n<tt.visibleColumnCount&&t+n<tt.columnCount;n++)e.push(t+n);return e}function C(){if(M){var e;i("img, svg",M).each(function(){e=i(this),e.css("max-width","98%"),e.css("max-height","98%"),e.css("height")||e.css("height","auto"),e.css("width")||e.css("width","auto")})}}function N(){var e=Math.round(tt.pageOffset/(tt.columnWidth+tt.columnGap)),t=e*L.height(),n=t+tt.visibleColumnCount*L.height();return{top:t,bottom:n}}r.extend(this,o.Events);var D,F,L,j,z,U,M,B,V,q,H,$=this,Q=e.$viewport,G=e.spine,W=e.userStyles,Z=e.bookStyles,X=e.iframeLoader,J=!1,Y=100,K=-1,et={width:void 0,height:void 0},tt={visibleColumnCount:2,columnGap:20,spreadCount:0,currentSpreadIndex:0,columnWidth:void 0,pageOffset:0,columnCount:0};this.render=function(){var e=h("reflowable_book_frame",{});z=i(e),Q.append(z);var n=t.viewerSettings();return n&&"undefined"!=typeof n.enableGPUHardwareAccelerationCSS3D||(n=new y({})),n.enableGPUHardwareAccelerationCSS3D&&z.css("transform","translateZ(0)"),b(),$},this.remove=function(){z.remove()},this.isReflowable=function(){return!0},this.onViewportResize=function(){P()&&A()};var nt=void 0;this.setViewSettings=function(e){nt=e,tt.columnGap=e.columnGap,Y=e.fontSize,w(),x(),P(),A()},this.applyStyles=function(){m(W.getStyles(),z.parent());var e=d.fromElement(z);n(e.padding),P(),A()},this.applyBookStyles=function(){M&&m(Z.getStyles(),M)},this.openPage=function(e){if(J)return void(F=e);if(e.spineItem&&e.spineItem!=D)return F=e,void _(e.spineItem);var t=void 0;if(void 0!==e.spineItemPageIndex)t=e.spineItemPageIndex;else if(e.elementId)t=j.getPageForElementId(e.elementId);else if(e.elementCfi)try{t=j.getPageForElementCfi(e.elementCfi,["cfi-marker","mo-cfi-highlight"],[],["MathJax_Message"])}catch(n){t=0,console.error(n)}else e.firstPage?t=0:e.lastPage?t=tt.columnCount-1:(console.debug("No criteria in pageRequest"),t=0);t>=0&&t<tt.columnCount?(tt.currentSpreadIndex=Math.floor(t/tt.visibleColumnCount),S(e.initiator,e.spineItem,e.elementId)):console.log("Illegal pageIndex value: ",t,"column count is ",tt.columnCount)},this.openPagePrev=function(e){if(D)if(tt.currentSpreadIndex>0)tt.currentSpreadIndex--,S(e);else{var t=G.prevItem(D,!0);if(t){var n=new p(t,e);n.setLastPage(),$.openPage(n)}}},this.openPageNext=function(e){if(D)if(tt.currentSpreadIndex<tt.spreadCount-1)tt.currentSpreadIndex++,S(e);else{var t=G.nextItem(D,!0);if(t){var n=new p(t,e);n.setFirstPage(),$.openPage(n)}}},this.getFirstVisibleElementCfi=function(){var e=N();return j.getFirstVisibleElementCfi(e)},this.getPaginationInfo=function(){var e=new u(G,!1);if(!D)return e;for(var t=O(),n=0,r=t.length;r>n;n++)e.addOpenPage(t[n],tt.columnCount,D.idref,D.index);return e},this.bookmarkCurrentPage=function(){return D?new a(D.idref,$.getFirstVisibleElementCfi()):new a("","")},this.getLoadedSpineItems=function(){return[D]},this.getElementByCfi=function(e,t,n,r,i){return e!=D?void console.error("spine item is not loaded"):j.getElementByCfi(t,n,r,i)},this.getElementById=function(e,t){return e!=D?void console.error("spine item is not loaded"):j.getElementById(t)},this.getElement=function(e,t){return e!=D?void console.error("spine item is not loaded"):j.getElement(t)},this.getFirstVisibleMediaOverlayElement=function(){var e=N();return j.getFirstVisibleMediaOverlayElement(e)},this.insureElementVisibility=function(e,t,n){var r=i(t);if(!j.isElementVisible(r,N())){var o=j.getPageForElement(r);if(-1!=o){var a=new p(D,n);a.setPageIndex(o);var s=t.id;s||(s=t.getAttribute("id")),s&&a.setElementId(s),$.openPage(a)}}}}var r=e("underscore"),i=e("zepto"),o=e("backbone"),a=e("../models/bookmark-data"),s=e("./cfi-navigation-logic"),u=e("../models/current-pages-info"),c=e("../events"),l=e("../helpers/deduce-synthetic-spread"),f=e("../internal-events"),h=e("../helpers/load-template"),d=e("../helpers/margins"),p=e("../models/page-open-request"),g=e("../helpers/trigger-layout"),m=e("../helpers/set-styles"),v=e("../helpers/update-html-font-size"),y=e("../models/viewer-settings");t.exports=n},{"../events":30,"../helpers/deduce-synthetic-spread":34,"../helpers/load-template":42,"../helpers/margins":43,"../helpers/set-styles":47,"../helpers/trigger-layout":48,"../helpers/update-html-font-size":49,"../internal-events":51,"../models/bookmark-data":52,"../models/current-pages-info":53,"../models/page-open-request":56,"../models/viewer-settings":63,"./cfi-navigation-logic":65,backbone:7,underscore:10,zepto:11}]},{},[13]);